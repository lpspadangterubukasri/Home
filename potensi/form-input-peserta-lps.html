<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pendataan Peserta LPS - Semua Kategori</title>

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://lpspadangterubukasri.github.io/Home/pendataan">
    <meta property="og:title" content="Pendataan Peserta LPS - Rumah Tangga, UMKM, Badan Usaha">
    <meta property="og:description" content="Formulir pendataan peserta Lembaga Pengelola Sampah (LPS) Kelurahan Padang Terubuk">
    <meta property="og:site_name" content="LPS PADANG TERUBUK">
    <meta property="og:image" content="https://lpspadangterubukasri.github.io/Home/data/foto/thumbnail.png">
    <meta property="og:image:secure_url" content="https://lpspadangterubukasri.github.io/Home/data/foto/thumbnail.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="https://lpspadangterubukasri.github.io/Home/data/foto/favicon.png">

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,400;14..32,500;14..32,600;14..32,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #f0f9f0 0%, #e8f5e9 50%, #c8e6c9 100%);
            background-attachment: fixed;
            padding: 2rem 1rem;
            position: relative;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 32px;
            box-shadow: 0 20px 40px rgba(0, 50, 0, 0.1), 0 8px 20px rgba(0, 80, 0, 0.06);
        }

        .glass-header {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(76, 175, 80, 0.2);
            border-radius: 60px;
            box-shadow: 0 10px 30px rgba(46, 125, 50, 0.15);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            position: sticky;
            top: 1rem;
            z-index: 10;
        }

        .logo-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            width: 48px;
            height: 48px;
            border-radius: 16px;
            background: white;
            padding: 4px;
            box-shadow: 0 4px 10px rgba(0, 80, 0, 0.1);
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .title h1 {
            font-size: 1.35rem;
            font-weight: 700;
            color: #1b5e20;
            letter-spacing: -0.01em;
            line-height: 1.3;
        }

        .title p {
            font-size: 0.8rem;
            color: #2e7d32;
            opacity: 0.8;
            font-weight: 500;
        }

        .back-button {
            width: 48px;
            height: 48px;
            border-radius: 30px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(76, 175, 80, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #2e7d32;
            font-size: 1.3rem;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .back-button:hover {
            background: white;
            border-color: #2e7d32;
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(46, 125, 50, 0.2);
        }

        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(10px);
            padding: 0.5rem;
            border-radius: 60px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .tab-btn {
            flex: 1;
            padding: 1rem 1.5rem;
            border: none;
            background: transparent;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        /* Warna tab berdasarkan tema */
        .tab-btn:nth-child(1) {
            color: #2e7d32;
        }
        .tab-btn:nth-child(2) {
            color: #1976d2;
        }
        .tab-btn:nth-child(3) {
            color: #7b1fa2;
        }

        .tab-btn.active:nth-child(1) {
            background: white;
            color: #1b5e20;
            box-shadow: 0 4px 15px rgba(46, 125, 50, 0.2);
        }
        .tab-btn.active:nth-child(2) {
            background: white;
            color: #0d47a1;
            box-shadow: 0 4px 15px rgba(25, 118, 210, 0.2);
        }
        .tab-btn.active:nth-child(3) {
            background: white;
            color: #4a148c;
            box-shadow: 0 4px 15px rgba(123, 31, 162, 0.2);
        }

        .tab-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.5);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Form Card dengan tema warna */
        .form-card {
            padding: 2rem 2rem 2.5rem;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }

        /* Tema Hijau untuk Rumah Tangga */
        #rumah-tangga .form-card {
            background: rgba(232, 245, 233, 0.75);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(76, 175, 80, 0.3);
        }
        #rumah-tangga .form-header i {
            color: #2e7d32;
            background: rgba(46, 125, 50, 0.15);
        }
        #rumah-tangga .form-header h2,
        #rumah-tangga .form-header p {
            color: #1b5e20;
        }
        #rumah-tangga .input-group label {
            color: #1b5e20;
        }
        #rumah-tangga .input-group label i {
            color: #2e7d32;
        }
        #rumah-tangga .input-wrapper i {
            color: #66bb6a;
        }
        #rumah-tangga .input-wrapper input:focus,
        #rumah-tangga .input-wrapper select:focus,
        #rumah-tangga .input-wrapper textarea:focus {
            border-color: #2e7d32;
            box-shadow: 0 0 0 4px rgba(46, 125, 50, 0.1);
        }

        /* Tema Biru untuk UMKM */
        #umkm .form-card {
            background: rgba(227, 242, 253, 0.75);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(33, 150, 243, 0.3);
        }
        #umkm .form-header i {
            color: #1976d2;
            background: rgba(25, 118, 210, 0.15);
        }
        #umkm .form-header h2,
        #umkm .form-header p {
            color: #0d47a1;
        }
        #umkm .input-group label {
            color: #0d47a1;
        }
        #umkm .input-group label i {
            color: #1976d2;
        }
        #umkm .input-wrapper i {
            color: #42a5f5;
        }
        #umkm .input-wrapper input:focus,
        #umkm .input-wrapper select:focus,
        #umkm .input-wrapper textarea:focus {
            border-color: #1976d2;
            box-shadow: 0 0 0 4px rgba(25, 118, 210, 0.1);
        }

        /* Tema Ungu untuk Badan Usaha */
        #badan-usaha .form-card {
            background: rgba(243, 229, 245, 0.75);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(156, 39, 176, 0.3);
        }
        #badan-usaha .form-header i {
            color: #7b1fa2;
            background: rgba(123, 31, 162, 0.15);
        }
        #badan-usaha .form-header h2,
        #badan-usaha .form-header p {
            color: #4a148c;
        }
        #badan-usaha .input-group label {
            color: #4a148c;
        }
        #badan-usaha .input-group label i {
            color: #7b1fa2;
        }
        #badan-usaha .input-wrapper i {
            color: #ab47bc;
        }
        #badan-usaha .input-wrapper input:focus,
        #badan-usaha .input-wrapper select:focus,
        #badan-usaha .input-wrapper textarea:focus {
            border-color: #7b1fa2;
            box-shadow: 0 0 0 4px rgba(123, 31, 162, 0.1);
        }

        .form-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 2rem;
        }

        .form-header i {
            font-size: 2rem;
            padding: 0.75rem;
            border-radius: 18px;
        }

        .form-header h2 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .form-header p {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        .full-width {
            grid-column: span 2;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        .input-group label {
            font-size: 0.85rem;
            font-weight: 600;
            letter-spacing: 0.3px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .input-group label i {
            font-size: 0.9rem;
            width: 18px;
        }

        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .input-wrapper i {
            position: absolute;
            left: 16px;
            font-size: 0.95rem;
        }

        .input-wrapper input,
        .input-wrapper select,
        .input-wrapper textarea {
            width: 100%;
            padding: 0.9rem 1rem 0.9rem 2.8rem;
            border: 1.5px solid;
            border-radius: 20px;
            font-size: 0.95rem;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(4px);
            transition: all 0.2s;
            color: #1e3a2a;
            font-weight: 500;
        }

        /* Warna border untuk setiap tema */
        #rumah-tangga .input-wrapper input,
        #rumah-tangga .input-wrapper select,
        #rumah-tangga .input-wrapper textarea {
            border-color: rgba(76, 175, 80, 0.2);
        }
        #umkm .input-wrapper input,
        #umkm .input-wrapper select,
        #umkm .input-wrapper textarea {
            border-color: rgba(33, 150, 243, 0.2);
        }
        #badan-usaha .input-wrapper input,
        #badan-usaha .input-wrapper select,
        #badan-usaha .input-wrapper textarea {
            border-color: rgba(156, 39, 176, 0.2);
        }

        .input-wrapper input::placeholder {
            color: #a5d6a7;
            font-weight: 400;
        }

        input[type="date"] {
            color: #1e3a2a;
        }
        input[type="date"]::-webkit-calendar-picker-indicator {
            opacity: 0.6;
            cursor: pointer;
        }

        /* Warna date picker icon per tema */
        #rumah-tangga input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0.5) sepia(1) hue-rotate(90deg);
        }
        #umkm input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0.5) sepia(1) hue-rotate(180deg);
        }
        #badan-usaha input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0.5) sepia(1) hue-rotate(250deg);
        }

        .input-wrapper textarea {
            min-height: 80px;
            resize: vertical;
            padding-top: 0.9rem;
        }

        select {
            appearance: none;
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 16px;
        }

        .submit-section {
            margin-top: 2.5rem;
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
        }

        .btn-submit {
            background: linear-gradient(145deg, #2e7d32, #1b5e20);
            color: white;
            border: none;
            padding: 1rem 3.5rem;
            border-radius: 40px;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(27, 94, 32, 0.3);
            transition: all 0.2s;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .btn-submit i {
            font-size: 1.2rem;
        }

        .btn-submit:hover {
            background: linear-gradient(145deg, #1b5e20, #0d4d13);
            transform: translateY(-3px);
            box-shadow: 0 15px 25px rgba(27, 94, 32, 0.4);
        }

        .btn-submit:active {
            transform: translateY(0);
        }

        /* Stats Cards */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.5);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-content {
            flex: 1;
        }

        .stat-label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.7;
            margin-bottom: 0.25rem;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            line-height: 1.2;
        }

        /* Warna stat per tema */
        #rumah-tangga .stat-icon {
            background: rgba(46, 125, 50, 0.15);
            color: #1b5e20;
        }
        #rumah-tangga .stat-value {
            color: #1b5e20;
        }

        #umkm .stat-icon {
            background: rgba(25, 118, 210, 0.15);
            color: #0d47a1;
        }
        #umkm .stat-value {
            color: #0d47a1;
        }

        #badan-usaha .stat-icon {
            background: rgba(123, 31, 162, 0.15);
            color: #4a148c;
        }
        #badan-usaha .stat-value {
            color: #4a148c;
        }

        /* Data Table Section */
        .data-section {
            margin-top: 2rem;
            margin-bottom: 2rem;
        }

        .data-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .data-header h3 {
            font-size: 1.3rem;
            font-weight: 600;
            color: #1b5e20;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .data-header h3 i {
            font-size: 1.5rem;
        }

        .entries-control {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.5);
            padding: 0.5rem 1rem;
            border-radius: 40px;
            backdrop-filter: blur(5px);
        }

        .entries-control select {
            padding: 0.5rem 2rem 0.5rem 1rem;
            border: 1px solid rgba(46, 125, 50, 0.2);
            border-radius: 30px;
            background: white;
            font-weight: 500;
            color: #1b5e20;
            cursor: pointer;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%232e7d32' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            appearance: none;
        }

        .search-box {
            display: flex;
            align-items: center;
            background: white;
            border-radius: 40px;
            padding: 0.5rem 1rem;
            border: 1px solid rgba(46, 125, 50, 0.2);
            flex: 1;
            max-width: 400px;
        }

        .search-box i {
            color: #2e7d32;
            margin-right: 10px;
        }

        .search-box input {
            border: none;
            outline: none;
            width: 100%;
            font-size: 0.95rem;
            background: transparent;
        }

        .search-box input::placeholder {
            color: #a5d6a7;
        }

        .search-filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .filter-chip {
            padding: 0.5rem 1.2rem;
            border-radius: 30px;
            background: white;
            border: 1px solid rgba(46, 125, 50, 0.2);
            font-size: 0.9rem;
            font-weight: 500;
            color: #2e7d32;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-chip.active {
            background: #2e7d32;
            color: white;
            border-color: #2e7d32;
        }

        .filter-chip i {
            margin-right: 5px;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 24px;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            padding: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        th {
            background: rgba(46, 125, 50, 0.1);
            padding: 1rem;
            font-weight: 600;
            color: #1b5e20;
            text-align: left;
            white-space: nowrap;
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid rgba(46, 125, 50, 0.1);
            color: #1e3a2a;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover td {
            background: rgba(46, 125, 50, 0.05);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-edit {
            width: 36px;
            height: 36px;
            border-radius: 12px;
            background: rgba(46, 125, 50, 0.1);
            border: none;
            color: #2e7d32;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-edit:hover {
            background: #2e7d32;
            color: white;
            transform: scale(1.05);
        }

        .pagination {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 10px;
            margin-top: 1.5rem;
        }

        .pagination button {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            border: 1px solid rgba(46, 125, 50, 0.2);
            background: white;
            color: #2e7d32;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pagination button:hover:not(:disabled) {
            background: #2e7d32;
            color: white;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-info {
            color: #2e7d32;
            font-weight: 500;
        }

        /* Modal Edit */
        .modal-edit-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 30, 0, 0.5);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-edit-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-edit-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 40px;
            padding: 2rem;
            max-width: 900px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 30px 50px rgba(0, 50, 0, 0.2);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-edit-overlay.active .modal-edit-content {
            transform: scale(1);
        }

        .modal-edit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .modal-edit-header h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1b5e20;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-close {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            background: rgba(46, 125, 50, 0.1);
            border: none;
            color: #2e7d32;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .modal-close:hover {
            background: #2e7d32;
            color: white;
        }

        .modal-edit-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        .btn-save {
            background: linear-gradient(145deg, #2e7d32, #1b5e20);
            color: white;
            border: none;
            padding: 1rem 2.5rem;
            border-radius: 40px;
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-cancel {
            background: transparent;
            border: 2px solid #2e7d32;
            color: #2e7d32;
            padding: 1rem 2.5rem;
            border-radius: 40px;
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-save:hover, .btn-cancel:hover {
            transform: translateY(-2px);
        }

        /* Modal, Loading, Notification (existing) */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 30, 0, 0.5);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            border-radius: 40px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 30px 50px rgba(0, 50, 0, 0.2);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal-content {
            transform: scale(1);
        }

        .modal-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(145deg, #2e7d32, #1b5e20);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            color: white;
            font-size: 2.5rem;
            box-shadow: 0 15px 25px rgba(46, 125, 50, 0.3);
        }

        .modal-content h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1b5e20;
            margin-bottom: 0.75rem;
        }

        .modal-content p {
            color: #2e7d32;
            margin-bottom: 2rem;
            font-size: 1rem;
            font-weight: 500;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .modal-btn {
            padding: 0.9rem 2rem;
            border-radius: 40px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            flex: 1;
        }

        .btn-primary {
            background: #2e7d32;
            color: white;
            box-shadow: 0 8px 15px rgba(46, 125, 50, 0.2);
        }

        .btn-primary:hover {
            background: #1b5e20;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid #2e7d32;
            color: #2e7d32;
        }

        .btn-secondary:hover {
            background: rgba(46, 125, 50, 0.05);
            transform: translateY(-2px);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #c8e6c9;
            border-top-color: #2e7d32;
            border-radius: 50%;
            animation: spin 1s infinite linear;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .footer {
            text-align: center;
            color: #2e7d32;
            font-size: 0.8rem;
            font-weight: 500;
            opacity: 0.7;
            margin-top: 2rem;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-left: 4px solid #2e7d32;
            border-radius: 12px;
            padding: 1rem 1.5rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            z-index: 3000;
            display: none;
            align-items: center;
            gap: 12px;
            backdrop-filter: blur(10px);
        }

        .notification.show {
            display: flex;
        }

        .notification i {
            color: #2e7d32;
            font-size: 1.2rem;
        }

        @media (max-width: 700px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            .full-width {
                grid-column: span 1;
            }
            .form-card {
                padding: 1.5rem;
            }
            .tab-navigation {
                flex-direction: column;
                border-radius: 30px;
            }
            .tab-btn {
                width: 100%;
            }
            .data-header {
                flex-direction: column;
                align-items: stretch;
            }
            .search-box {
                max-width: 100%;
            }
            .modal-edit-content {
                padding: 1.5rem;
                max-height: 85vh;
            }
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Warna untuk tabel per tema */
        #rumah-tangga .table-container {
            border-color: rgba(76, 175, 80, 0.3);
        }
        #rumah-tangga th {
            background: rgba(46, 125, 50, 0.1);
            color: #1b5e20;
        }

        #umkm .table-container {
            border-color: rgba(33, 150, 243, 0.3);
        }
        #umkm th {
            background: rgba(25, 118, 210, 0.1);
            color: #0d47a1;
        }

        #badan-usaha .table-container {
            border-color: rgba(156, 39, 176, 0.3);
        }
        #badan-usaha th {
            background: rgba(123, 31, 162, 0.1);
            color: #4a148c;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header dengan Logo dan Tombol Kembali -->
        <div class="header glass-header">
            <div class="logo-title">
                <div class="logo">
                    <img src="https://lpspadangterubukasri.github.io/Home/data/foto/favicon.png" alt="Logo LPS">
                </div>
                <div class="title">
                    <h1>PENDATAAN PESERTA LPS</h1>
                    <p>RUMAH TANGGA • UMKM • BADAN USAHA</p>
                </div>
            </div>
            <a href="https://lpspadangterubukasri.github.io/Home" class="back-button">
                <i class="fas fa-arrow-left"></i>
            </a>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-navigation glass-card">
            <button class="tab-btn active" onclick="switchTab('rumah-tangga')">
                <i class="fas fa-home"></i> RUMAH TANGGA
            </button>
            <button class="tab-btn" onclick="switchTab('umkm')">
                <i class="fas fa-store"></i> UMKM
            </button>
            <button class="tab-btn" onclick="switchTab('badan-usaha')">
                <i class="fas fa-building"></i> BADAN USAHA
            </button>
        </div>

        <!-- TAB 1: RUMAH TANGGA (Hijau) -->
        <div id="rumah-tangga" class="tab-content active">
            <!-- Form Input -->
            <div class="form-card">
                <div class="form-header">
                    <i class="fas fa-home"></i>
                    <div>
                        <h2>Formulir Pendataan Rumah Tangga</h2>
                        <p>Mohon Isi Data Dengan Teliti</p>
                    </div>
                </div>

                <div class="form-grid">
                    <!-- TANGGAL_INPUT -->
                    <div class="input-group full-width">
                        <label><i class="fas fa-calendar-alt"></i> TANGGAL INPUT</label>
                        <div class="input-wrapper">
                            <i class="fas fa-calendar-check"></i>
                            <input type="date" id="rt_tanggal" class="tanggal-input">
                        </div>
                    </div>

                    <!-- NAMA_PESERTA -->
                    <div class="input-group full-width">
                        <label><i class="fas fa-user"></i> NAMA PESERTA</label>
                        <div class="input-wrapper">
                            <i class="fas fa-user-pen"></i>
                            <input type="text" id="rt_nama" class="uppercase-input" placeholder="NAMA LENGKAP">
                        </div>
                    </div>

                    <!-- NO_NIK & NO_KK -->
                    <div class="input-group">
                        <label><i class="fas fa-id-card"></i> NO. NIK</label>
                        <div class="input-wrapper">
                            <i class="fas fa-id-card"></i>
                            <input type="text" id="rt_nik" class="nik-input" placeholder="16 DIGIT NIK" maxlength="16">
                        </div>
                    </div>

                    <div class="input-group">
                        <label><i class="fas fa-id-card-clip"></i> NO. KK</label>
                        <div class="input-wrapper">
                            <i class="fas fa-id-card-clip"></i>
                            <input type="text" id="rt_kk" class="kk-input" placeholder="16 DIGIT NO KK" maxlength="16">
                        </div>
                    </div>

                    <!-- ALAMAT -->
                    <div class="input-group full-width">
                        <label><i class="fas fa-map-pin"></i> ALAMAT</label>
                        <div class="input-wrapper">
                            <i class="fas fa-map-location-dot"></i>
                            <textarea id="rt_alamat" class="uppercase-input" placeholder="ALAMAT DAN NO RUMAH"></textarea>
                        </div>
                    </div>

                    <!-- RT & RW -->
                    <div class="input-group">
                        <label><i class="fas fa-road"></i> RT</label>
                        <div class="input-wrapper">
                            <i class="fas fa-route"></i>
                            <input type="text" id="rt_rt" class="uppercase-input rt-input" placeholder="CONTOH: 001" maxlength="3" oninput="formatRT_RW(this)">
                        </div>
                    </div>

                    <div class="input-group">
                        <label><i class="fas fa-road"></i> RW</label>
                        <div class="input-wrapper">
                            <i class="fas fa-route"></i>
                            <input type="text" id="rt_rw" class="uppercase-input rw-input" placeholder="CONTOH: 002" maxlength="3" oninput="formatRT_RW(this)">
                        </div>
                    </div>

                    <!-- KELURAHAN, KECAMATAN, KOTA, PROVINSI -->
                    <div class="input-group">
                        <label><i class="fas fa-map"></i> KELURAHAN</label>
                        <div class="input-wrapper">
                            <i class="fas fa-map"></i>
                            <input type="text" id="rt_kelurahan" class="uppercase-input" value="PADANG TERUBUK">
                        </div>
                    </div>

                    <div class="input-group">
                        <label><i class="fas fa-map"></i> KECAMATAN</label>
                        <div class="input-wrapper">
                            <i class="fas fa-map"></i>
                            <input type="text" id="rt_kecamatan" class="uppercase-input" value="SENAPELAN">
                        </div>
                    </div>

                    <div class="input-group">
                        <label><i class="fas fa-city"></i> KOTA</label>
                        <div class="input-wrapper">
                            <i class="fas fa-city"></i>
                            <input type="text" id="rt_kota" class="uppercase-input" value="PEKANBARU">
                        </div>
                    </div>

                    <div class="input-group">
                        <label><i class="fas fa-flag"></i> PROVINSI</label>
                        <div class="input-wrapper">
                            <i class="fas fa-flag"></i>
                            <input type="text" id="rt_provinsi" class="uppercase-input" value="RIAU">
                        </div>
                    </div>

                    <!-- NO_TELP -->
                    <div class="input-group full-width">
                        <label><i class="fas fa-phone-alt"></i> NO. TELP / HP</label>
                        <div class="input-wrapper">
                            <i class="fas fa-phone-alt"></i>
                            <input type="tel" id="rt_telp" class="telp-input" placeholder="08XXXXXXXXXX" maxlength="15">
                        </div>
                    </div>

                    <!-- STATUS -->
                    <div class="input-group">
                        <label><i class="fas fa-toggle-on"></i> STATUS</label>
                        <div class="input-wrapper">
                            <i class="fas fa-check-circle"></i>
                            <select id="rt_status">
                                <option value="" selected disabled>-- PILIH STATUS --</option>
                                <option value="PESERTA LPS">PESERTA LPS</option>
                                <option value="PESERTA SUBSIDI SILANG">PESERTA SUBSIDI SILANG</option>
                                <option value="TIDAK IKUT LPS">TIDAK IKUT LPS</option>
                            </select>
                        </div>
                    </div>

                    <!-- TARIF IURAN -->
                    <div class="input-group">
                        <label><i class="fas fa-money-bill-wave"></i> TARIF IURAN (Rp)</label>
                        <div class="input-wrapper">
                            <i class="fas fa-hand-holding-usd"></i>
                            <input type="number" id="rt_tarif" placeholder="CONTOH: 50000" min="0" step="1000">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="stats-container" id="rt_stats">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">PESERTA LPS</div>
                        <div class="stat-value" id="rt_stat_lps">0</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-hand-holding-heart"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">SUBSIDI SILANG</div>
                        <div class="stat-value" id="rt_stat_subsidi">0</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-times-circle"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">TIDAK IKUT</div>
                        <div class="stat-value" id="rt_stat_tidak">0</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">TOTAL</div>
                        <div class="stat-value" id="rt_stat_total">0</div>
                    </div>
                </div>
            </div>
            
            <!-- Tombol Submit Rumah Tangga -->
            <div class="submit-section">
                <button class="btn-submit" id="submitRumahTanggaBtn">
                    <i class="fas fa-cloud-upload-alt"></i>
                    KIRIM DATA
                </button>
            </div>

            <!-- Data Table Section -->
            <div class="data-section">
                <div class="data-header">
                    <h3><i class="fas fa-database"></i> Data Rumah Tangga</h3>
                    <div class="entries-control">
                        <span>Tampilkan</span>
                        <select id="rt_entries" onchange="loadData('rumah-tangga')">
                            <option value="10">10</option>
                            <option value="50">50</option>
                            <option value="500">500</option>
                            <option value="1000">1000</option>
                        </select>
                        <span>entri</span>
                    </div>
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="rt_search" placeholder="Cari berdasarkan Nama, Alamat, RT, RW, NIK, KK..." onkeyup="filterData('rumah-tangga')">
                    </div>
                </div>

                <div class="search-filters">
                    <span class="filter-chip active" onclick="setFilter('rumah-tangga', 'nama', event)"><i class="fas fa-user"></i> Nama</span>
                    <span class="filter-chip" onclick="setFilter('rumah-tangga', 'alamat', event)"><i class="fas fa-map-pin"></i> Alamat</span>
                    <span class="filter-chip" onclick="setFilter('rumah-tangga', 'rt', event)"><i class="fas fa-road"></i> RT</span>
                    <span class="filter-chip" onclick="setFilter('rumah-tangga', 'rw', event)"><i class="fas fa-road"></i> RW</span>
                    <span class="filter-chip" onclick="setFilter('rumah-tangga', 'nik', event)"><i class="fas fa-id-card"></i> NIK</span>
                    <span class="filter-chip" onclick="setFilter('rumah-tangga', 'kk', event)"><i class="fas fa-id-card-clip"></i> KK</span>
                </div>

                <div class="table-container">
                    <table id="rt_table">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Aksi</th>
                                <th>Tanggal</th>
                                <th>Nama</th>
                                <th>NIK</th>
                                <th>KK</th>
                                <th>Alamat</th>
                                <th>RT</th>
                                <th>RW</th>
                                <th>Kelurahan</th>
                                <th>Kecamatan</th>
                                <th>Kota</th>
                                <th>Provinsi</th>
                                <th>No Telp</th>
                                <th>Status</th>
                                <th>Tarif</th>
                            </tr>
                        </thead>
                        <tbody id="rt_table_body">
                            <tr>
                                <td colspan="16" style="text-align: center; padding: 2rem;">
                                    <i class="fas fa-spinner fa-spin"></i> Memuat data...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="pagination" id="rt_pagination">
                    <button onclick="changePage('rumah-tangga', 'prev')" id="rt_prev" disabled><i class="fas fa-chevron-left"></i></button>
                    <span class="pagination-info" id="rt_page_info">Halaman 1 dari 1</span>
                    <button onclick="changePage('rumah-tangga', 'next')" id="rt_next" disabled><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
        </div>

        <!-- TAB 2: UMKM (Biru) -->
        <div id="umkm" class="tab-content">
            <!-- Form Input -->
            <div class="form-card">
                <div class="form-header">
                    <i class="fas fa-store"></i>
                    <div>
                        <h2>Formulir Pendataan UMKM</h2>
                        <p>Mohon Isi Data Dengan Teliti</p>
                    </div>
                </div>

                <div class="form-grid">
                    <!-- TANGGAL_INPUT -->
                    <div class="input-group full-width">
                        <label><i class="fas fa-calendar-alt"></i> TANGGAL INPUT</label>
                        <div class="input-wrapper">
                            <i class="fas fa-calendar-check"></i>
                            <input type="date" id="umkm_tanggal" class="tanggal-input">
                        </div>
                    </div>

                    <!-- NAMA_PESERTA -->
                    <div class="input-group">
                        <label><i class="fas fa-user"></i> NAMA PEMILIK</label>
                        <div class="input-wrapper">
                            <i class="fas fa-user-pen"></i>
                            <input type="text" id="umkm_nama" class="uppercase-input" placeholder="NAMA LENGKAP PEMILIK">
                        </div>
                    </div>

                    <!-- NAMA_UMKM -->
                    <div class="input-group">
                        <label><i class="fas fa-store-alt"></i> NAMA UMKM</label>
                        <div class="input-wrapper">
                            <i class="fas fa-store-alt"></i>
                            <input type="text" id="umkm_nama_usaha" class="uppercase-input" placeholder="NAMA USAHA">
                        </div>
                    </div>

                    <!-- NO_SURAT_IZIN_USAHA_UMKM -->
                    <div class="input-group full-width">
                        <label><i class="fas fa-file-contract"></i> NO. SURAT IZIN USAHA</label>
                        <div class="input-wrapper">
                            <i class="fas fa-file-contract"></i>
                            <input type="text" id="umkm_no_izin" class="uppercase-input" placeholder="NOMOR IZIN USAHA">
                        </div>
                    </div>

                    <!-- NO_NIK & NO_KK -->
                    <div class="input-group">
                        <label><i class="fas fa-id-card"></i> NO. NIK</label>
                        <div class="input-wrapper">
                            <i class="fas fa-id-card"></i>
                            <input type="text" id="umkm_nik" class="nik-input" placeholder="16 DIGIT NIK" maxlength="16">
                        </div>
                    </div>

                    <div class="input-group">
                        <label><i class="fas fa-id-card-clip"></i> NO. KK</label>
                        <div class="input-wrapper">
                            <i class="fas fa-id-card-clip"></i>
                            <input type="text" id="umkm_kk" class="kk-input" placeholder="16 DIGIT NO KK" maxlength="16">
                        </div>
                    </div>

                    <!-- ALAMAT -->
                    <div class="input-group full-width">
                        <label><i class="fas fa-map-pin"></i> ALAMAT USAHA</label>
                        <div class="input-wrapper">
                            <i class="fas fa-map-location-dot"></i>
                            <textarea id="umkm_alamat" class="uppercase-input" placeholder="ALAMAT LENGKAP USAHA"></textarea>
                        </div>
                    </div>

                    <!-- RT & RW -->
                    <div class="input-group">
                        <label><i class="fas fa-road"></i> RT</label>
                        <div class="input-wrapper">
                            <i class="fas fa-route"></i>
                            <input type="text" id="umkm_rt" class="uppercase-input rt-input" placeholder="CONTOH: 001" maxlength="3" oninput="formatRT_RW(this)">
                        </div>
                    </div>

                    <div class="input-group">
                        <label><i class="fas fa-road"></i> RW</label>
                        <div class="input-wrapper">
                            <i class="fas fa-route"></i>
                            <input type="text" id="umkm_rw" class="uppercase-input rw-input" placeholder="CONTOH: 002" maxlength="3" oninput="formatRT_RW(this)">
                        </div>
                    </div>

                    <!-- KELURAHAN, KECAMATAN, KOTA, PROVINSI -->
                    <div class="input-group">
                        <label><i class="fas fa-map"></i> KELURAHAN</label>
                        <div class="input-wrapper">
                            <i class="fas fa-map"></i>
                            <input type="text" id="umkm_kelurahan" class="uppercase-input" value="PADANG TERUBUK">
                        </div>
                    </div>

                    <div class="input-group">
                        <label><i class="fas fa-map"></i> KECAMATAN</label>
                        <div class="input-wrapper">
                            <i class="fas fa-map"></i>
                            <input type="text" id="umkm_kecamatan" class="uppercase-input" value="SENAPELAN">
                        </div>
                    </div>

                    <div class="input-group">
                        <label><i class="fas fa-city"></i> KOTA</label>
                        <div class="input-wrapper">
                            <i class="fas fa-city"></i>
                            <input type="text" id="umkm_kota" class="uppercase-input" value="PEKANBARU">
                        </div>
                    </div>

                    <div class="input-group">
                        <label><i class="fas fa-flag"></i> PROVINSI</label>
                        <div class="input-wrapper">
                            <i class="fas fa-flag"></i>
                            <input type="text" id="umkm_provinsi" class="uppercase-input" value="RIAU">
                        </div>
                    </div>

                    <!-- NO_TELP -->
                    <div class="input-group full-width">
                        <label><i class="fas fa-phone-alt"></i> NO. TELP / HP</label>
                        <div class="input-wrapper">
                            <i class="fas fa-phone-alt"></i>
                            <input type="tel" id="umkm_telp" class="telp-input" placeholder="08XXXXXXXXXX" maxlength="15">
                        </div>
                    </div>

                    <!-- STATUS -->
                    <div class="input-group">
                        <label><i class="fas fa-toggle-on"></i> STATUS</label>
                        <div class="input-wrapper">
                            <i class="fas fa-check-circle"></i>
                            <select id="umkm_status">
                                <option value="" selected disabled>-- PILIH STATUS --</option>
                                <option value="PESERTA LPS">PESERTA LPS</option>
                                <option value="PESERTA DLHK">PESERTA DLHK</option>
                                <option value="TIDAK IKUT LPS">TIDAK IKUT LPS</option>
                            </select>
                        </div>
                    </div>

                    <!-- TARIF IURAN -->
                    <div class="input-group">
                        <label><i class="fas fa-money-bill-wave"></i> TARIF IURAN (Rp)</label>
                        <div class="input-wrapper">
                            <i class="fas fa-hand-holding-usd"></i>
                            <input type="number" id="umkm_tarif" placeholder="CONTOH: 50000" min="0" step="1000">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="stats-container" id="umkm_stats">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-store"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">PESERTA LPS</div>
                        <div class="stat-value" id="umkm_stat_lps">0</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-leaf"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">PESERTA DLHK</div>
                        <div class="stat-value" id="umkm_stat_dlhk">0</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-times-circle"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">TIDAK IKUT</div>
                        <div class="stat-value" id="umkm_stat_tidak">0</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">TOTAL</div>
                        <div class="stat-value" id="umkm_stat_total">0</div>
                    </div>
                </div>
            </div>
            
            <!-- Tombol Submit UMKM -->
            <div class="submit-section">
                <button class="btn-submit" id="submitUmkmBtn">
                    <i class="fas fa-cloud-upload-alt"></i>
                    KIRIM DATA
                </button>
            </div>

            <!-- Data Table Section -->
            <div class="data-section">
                <div class="data-header">
                    <h3><i class="fas fa-database"></i> Data UMKM</h3>
                    <div class="entries-control">
                        <span>Tampilkan</span>
                        <select id="umkm_entries" onchange="loadData('umkm')">
                            <option value="10">10</option>
                            <option value="50">50</option>
                            <option value="500">500</option>
                            <option value="1000">1000</option>
                        </select>
                        <span>entri</span>
                    </div>
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="umkm_search" placeholder="Cari berdasarkan Nama, Alamat, RT, RW, NIK, KK..." onkeyup="filterData('umkm')">
                    </div>
                </div>

                <div class="search-filters">
                    <span class="filter-chip active" onclick="setFilter('umkm', 'nama', event)"><i class="fas fa-user"></i> Nama</span>
                    <span class="filter-chip" onclick="setFilter('umkm', 'alamat', event)"><i class="fas fa-map-pin"></i> Alamat</span>
                    <span class="filter-chip" onclick="setFilter('umkm', 'rt', event)"><i class="fas fa-road"></i> RT</span>
                    <span class="filter-chip" onclick="setFilter('umkm', 'rw', event)"><i class="fas fa-road"></i> RW</span>
                    <span class="filter-chip" onclick="setFilter('umkm', 'nik', event)"><i class="fas fa-id-card"></i> NIK</span>
                    <span class="filter-chip" onclick="setFilter('umkm', 'kk', event)"><i class="fas fa-id-card-clip"></i> KK</span>
                </div>

                <div class="table-container">
                    <table id="umkm_table">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Aksi</th>
                                <th>Tanggal</th>
                                <th>Pemilik</th>
                                <th>Nama UMKM</th>
                                <th>No Izin</th>
                                <th>NIK</th>
                                <th>KK</th>
                                <th>Alamat</th>
                                <th>RT</th>
                                <th>RW</th>
                                <th>Kelurahan</th>
                                <th>Kecamatan</th>
                                <th>Kota</th>
                                <th>Provinsi</th>
                                <th>No Telp</th>
                                <th>Status</th>
                                <th>Tarif</th>
                            </tr>
                        </thead>
                        <tbody id="umkm_table_body">
                            <tr>
                                <td colspan="18" style="text-align: center; padding: 2rem;">
                                    <i class="fas fa-spinner fa-spin"></i> Memuat data...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="pagination" id="umkm_pagination">
                    <button onclick="changePage('umkm', 'prev')" id="umkm_prev" disabled><i class="fas fa-chevron-left"></i></button>
                    <span class="pagination-info" id="umkm_page_info">Halaman 1 dari 1</span>
                    <button onclick="changePage('umkm', 'next')" id="umkm_next" disabled><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
        </div>

        <!-- TAB 3: BADAN USAHA (Ungu) -->
        <div id="badan-usaha" class="tab-content">
            <!-- Form Input -->
            <div class="form-card">
                <div class="form-header">
                    <i class="fas fa-building"></i>
                    <div>
                        <h2>Formulir Pendataan Badan Usaha</h2>
                        <p>Mohon Isi Data Dengan Teliti</p>
                    </div>
                </div>

                <div class="form-grid">
                    <!-- TANGGAL_INPUT -->
                    <div class="input-group full-width">
                        <label><i class="fas fa-calendar-alt"></i> TANGGAL INPUT</label>
                        <div class="input-wrapper">
                            <i class="fas fa-calendar-check"></i>
                            <input type="date" id="bu_tanggal" class="tanggal-input">
                        </div>
                    </div>

                    <!-- NAMA_PESERTA -->
                    <div class="input-group">
                        <label><i class="fas fa-user"></i> NAMA PENANGGUNG JAWAB</label>
                        <div class="input-wrapper">
                            <i class="fas fa-user-pen"></i>
                            <input type="text" id="bu_nama" class="uppercase-input" placeholder="NAMA LENGKAP">
                        </div>
                    </div>

                    <!-- NAMA_BADAN_USAHA -->
                    <div class="input-group">
                        <label><i class="fas fa-building"></i> NAMA BADAN USAHA</label>
                        <div class="input-wrapper">
                            <i class="fas fa-building"></i>
                            <input type="text" id="bu_nama_usaha" class="uppercase-input" placeholder="NAMA PERUSAHAAN">
                        </div>
                    </div>

                    <!-- NO_SURAT_IZIN_BADAN_USAHA -->
                    <div class="input-group full-width">
                        <label><i class="fas fa-file-contract"></i> NO. SURAT IZIN USAHA</label>
                        <div class="input-wrapper">
                            <i class="fas fa-file-contract"></i>
                            <input type="text" id="bu_no_izin" class="uppercase-input" placeholder="NIB / SIUP / IZIN LAINNYA">
                        </div>
                    </div>

                    <!-- NO_NIK & NO_KK -->
                    <div class="input-group">
                        <label><i class="fas fa-id-card"></i> NO. NIK</label>
                        <div class="input-wrapper">
                            <i class="fas fa-id-card"></i>
                            <input type="text" id="bu_nik" class="nik-input" placeholder="16 DIGIT NIK" maxlength="16">
                        </div>
                    </div>

                    <div class="input-group">
                        <label><i class="fas fa-id-card-clip"></i> NO. KK</label>
                        <div class="input-wrapper">
                            <i class="fas fa-id-card-clip"></i>
                            <input type="text" id="bu_kk" class="kk-input" placeholder="16 DIGIT NO KK" maxlength="16">
                        </div>
                    </div>

                    <!-- ALAMAT -->
                    <div class="input-group full-width">
                        <label><i class="fas fa-map-pin"></i> ALAMAT USAHA</label>
                        <div class="input-wrapper">
                            <i class="fas fa-map-location-dot"></i>
                            <textarea id="bu_alamat" class="uppercase-input" placeholder="ALAMAT LENGKAP USAHA"></textarea>
                        </div>
                    </div>

                    <!-- RT & RW -->
                    <div class="input-group">
                        <label><i class="fas fa-road"></i> RT</label>
                        <div class="input-wrapper">
                            <i class="fas fa-route"></i>
                            <input type="text" id="bu_rt" class="uppercase-input rt-input" placeholder="CONTOH: 001" maxlength="3" oninput="formatRT_RW(this)">
                        </div>
                    </div>

                    <div class="input-group">
                        <label><i class="fas fa-road"></i> RW</label>
                        <div class="input-wrapper">
                            <i class="fas fa-route"></i>
                            <input type="text" id="bu_rw" class="uppercase-input rw-input" placeholder="CONTOH: 002" maxlength="3" oninput="formatRT_RW(this)">
                        </div>
                    </div>

                    <!-- KELURAHAN, KECAMATAN, KOTA, PROVINSI -->
                    <div class="input-group">
                        <label><i class="fas fa-map"></i> KELURAHAN</label>
                        <div class="input-wrapper">
                            <i class="fas fa-map"></i>
                            <input type="text" id="bu_kelurahan" class="uppercase-input" value="PADANG TERUBUK">
                        </div>
                    </div>

                    <div class="input-group">
                        <label><i class="fas fa-map"></i> KECAMATAN</label>
                        <div class="input-wrapper">
                            <i class="fas fa-map"></i>
                            <input type="text" id="bu_kecamatan" class="uppercase-input" value="SENAPELAN">
                        </div>
                    </div>

                    <div class="input-group">
                        <label><i class="fas fa-city"></i> KOTA</label>
                        <div class="input-wrapper">
                            <i class="fas fa-city"></i>
                            <input type="text" id="bu_kota" class="uppercase-input" value="PEKANBARU">
                        </div>
                    </div>

                    <div class="input-group">
                        <label><i class="fas fa-flag"></i> PROVINSI</label>
                        <div class="input-wrapper">
                            <i class="fas fa-flag"></i>
                            <input type="text" id="bu_provinsi" class="uppercase-input" value="RIAU">
                        </div>
                    </div>

                    <!-- NO_TELP -->
                    <div class="input-group full-width">
                        <label><i class="fas fa-phone-alt"></i> NO. TELP / HP</label>
                        <div class="input-wrapper">
                            <i class="fas fa-phone-alt"></i>
                            <input type="tel" id="bu_telp" class="telp-input" placeholder="08XXXXXXXXXX" maxlength="15">
                        </div>
                    </div>

                    <!-- STATUS -->
                    <div class="input-group">
                        <label><i class="fas fa-toggle-on"></i> STATUS</label>
                        <div class="input-wrapper">
                            <i class="fas fa-check-circle"></i>
                            <select id="bu_status">
                                <option value="" selected disabled>-- PILIH STATUS --</option>
                                <option value="PESERTA LPS">PESERTA LPS</option>
                                <option value="PESERTA DLHK">PESERTA DLHK</option>
                                <option value="TIDAK IKUT LPS">TIDAK IKUT LPS</option>
                            </select>
                        </div>
                    </div>

                    <!-- TARIF IURAN -->
                    <div class="input-group">
                        <label><i class="fas fa-money-bill-wave"></i> TARIF IURAN (Rp)</label>
                        <div class="input-wrapper">
                            <i class="fas fa-hand-holding-usd"></i>
                            <input type="number" id="bu_tarif" placeholder="CONTOH: 50000" min="0" step="1000">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="stats-container" id="bu_stats">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">PESERTA LPS</div>
                        <div class="stat-value" id="bu_stat_lps">0</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-leaf"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">PESERTA DLHK</div>
                        <div class="stat-value" id="bu_stat_dlhk">0</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-times-circle"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">TIDAK IKUT</div>
                        <div class="stat-value" id="bu_stat_tidak">0</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">TOTAL</div>
                        <div class="stat-value" id="bu_stat_total">0</div>
                    </div>
                </div>
            </div>
            
            <!-- Tombol Submit Badan Usaha -->
            <div class="submit-section">
                <button class="btn-submit" id="submitBadanUsahaBtn">
                    <i class="fas fa-cloud-upload-alt"></i>
                    KIRIM DATA
                </button>
            </div>

            <!-- Data Table Section -->
            <div class="data-section">
                <div class="data-header">
                    <h3><i class="fas fa-database"></i> Data Badan Usaha</h3>
                    <div class="entries-control">
                        <span>Tampilkan</span>
                        <select id="bu_entries" onchange="loadData('badan-usaha')">
                            <option value="10">10</option>
                            <option value="50">50</option>
                            <option value="500">500</option>
                            <option value="1000">1000</option>
                        </select>
                        <span>entri</span>
                    </div>
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="bu_search" placeholder="Cari berdasarkan Nama, Alamat, RT, RW, NIK, KK..." onkeyup="filterData('badan-usaha')">
                    </div>
                </div>

                <div class="search-filters">
                    <span class="filter-chip active" onclick="setFilter('badan-usaha', 'nama', event)"><i class="fas fa-user"></i> Nama</span>
                    <span class="filter-chip" onclick="setFilter('badan-usaha', 'alamat', event)"><i class="fas fa-map-pin"></i> Alamat</span>
                    <span class="filter-chip" onclick="setFilter('badan-usaha', 'rt', event)"><i class="fas fa-road"></i> RT</span>
                    <span class="filter-chip" onclick="setFilter('badan-usaha', 'rw', event)"><i class="fas fa-road"></i> RW</span>
                    <span class="filter-chip" onclick="setFilter('badan-usaha', 'nik', event)"><i class="fas fa-id-card"></i> NIK</span>
                    <span class="filter-chip" onclick="setFilter('badan-usaha', 'kk', event)"><i class="fas fa-id-card-clip"></i> KK</span>
                </div>

                <div class="table-container">
                    <table id="bu_table">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Aksi</th>
                                <th>Tanggal</th>
                                <th>Penanggung Jawab</th>
                                <th>Nama Badan Usaha</th>
                                <th>No Izin</th>
                                <th>NIK</th>
                                <th>KK</th>
                                <th>Alamat</th>
                                <th>RT</th>
                                <th>RW</th>
                                <th>Kelurahan</th>
                                <th>Kecamatan</th>
                                <th>Kota</th>
                                <th>Provinsi</th>
                                <th>No Telp</th>
                                <th>Status</th>
                                <th>Tarif</th>
                            </tr>
                        </thead>
                        <tbody id="bu_table_body">
                            <tr>
                                <td colspan="18" style="text-align: center; padding: 2rem;">
                                    <i class="fas fa-spinner fa-spin"></i> Memuat data...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="pagination" id="bu_pagination">
                    <button onclick="changePage('badan-usaha', 'prev')" id="bu_prev" disabled><i class="fas fa-chevron-left"></i></button>
                    <span class="pagination-info" id="bu_page_info">Halaman 1 dari 1</span>
                    <button onclick="changePage('badan-usaha', 'next')" id="bu_next" disabled><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>© 2026 Lembaga Pengelola Sampah Padang Terubuk<br>Jika terdapat kendala dalam pengisian Form Hubungi Admin - TRY HOLLY (0821-7008-9590)</p>
        </div>
    </div>

    <!-- Modal Sukses -->
    <div class="modal-overlay" id="successModal">
        <div class="modal-content">
            <div class="modal-icon">
                <i class="fas fa-check"></i>
            </div>
            <h3>BERHASIL!</h3>
            <p>Data peserta berhasil disimpan ke DATABASE LPS Padang Terubuk.</p>
            <div class="modal-actions">
                <button class="modal-btn btn-primary" id="lanjutBtn">ISI LAGI</button>
                <button class="modal-btn btn-secondary" id="keluarBtn">KELUAR</button>
            </div>
        </div>
    </div>

    <!-- Modal Edit -->
    <div class="modal-edit-overlay" id="editModal">
        <div class="modal-edit-content">
            <div class="modal-edit-header">
                <h3><i class="fas fa-edit"></i> Edit Data</h3>
                <button class="modal-close" onclick="closeEditModal()"><i class="fas fa-times"></i></button>
            </div>
            <div id="editFormContainer">
                <!-- Form akan diisi secara dinamis -->
            </div>
            <div class="modal-edit-actions">
                <button class="btn-cancel" onclick="closeEditModal()"><i class="fas fa-times"></i> BATAL</button>
                <button class="btn-save" onclick="saveEdit()"><i class="fas fa-save"></i> SIMPAN</button>
            </div>
        </div>
    </div>

    <!-- Loading -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <!-- Notifikasi -->
    <div class="notification" id="notification">
        <i class="fas fa-info-circle"></i>
        <span id="notificationMessage"></span>
    </div>

    <script>
    // GANTI DENGAN URL APPS SCRIPT ANDA - PASTIKAN SUDAH DEPLOY VERSI BARU
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzoO73RlJOGV2K2-WxYYz7o9aV4ZPLlr6eDdCQbbVZGyODMJrEYfB3KDm3woEbKtPfA/exec';

    // Set default tanggal untuk semua form
    document.querySelectorAll('.tanggal-input').forEach(input => {
        input.valueAsDate = new Date();
    });

    // Fungsi uppercase untuk semua input text
    document.querySelectorAll('.uppercase-input').forEach(input => {
        input.addEventListener('input', function() {
            this.value = this.value.toUpperCase();
        });
    });

    // Filter angka untuk semua input
    document.querySelectorAll('.nik-input, .kk-input, .telp-input, .rt-input, .rw-input').forEach(input => {
        input.addEventListener('input', function() {
            // Hanya angka
            this.value = this.value.replace(/[^0-9]/g, '');

            // Batasi panjang
            if (this.classList.contains('nik-input') || this.classList.contains('kk-input')) {
                if (this.value.length > 16) this.value = this.value.slice(0, 16);
            } else if (this.classList.contains('rt-input') || this.classList.contains('rw-input')) {
                if (this.value.length > 3) this.value = this.value.slice(0, 3);
            } else if (this.classList.contains('telp-input')) {
                if (this.value.length > 15) this.value = this.value.slice(0, 15);
            }
        });
    });

    // Fungsi format RT/RW
    window.formatRT_RW = function(input) {
        input.value = input.value.replace(/[^0-9]/g, '');
        if (input.value.length > 3) {
            input.value = input.value.slice(0, 3);
        }
    };

    // Element global
    const modal = document.getElementById('successModal');
    const editModal = document.getElementById('editModal');
    const loading = document.getElementById('loadingOverlay');
    const notification = document.getElementById('notification');
    const notificationMessage = document.getElementById('notificationMessage');

    // ============ FUNGSI HELPER UNTUK MAPPING ID ============
    function getPrefix(tabId) {
        if (tabId === 'rumah-tangga') return 'rt';
        if (tabId === 'umkm') return 'umkm';
        if (tabId === 'badan-usaha') return 'bu';
        return '';
    }

    function getElementId(tabId, elementType) {
        const prefix = getPrefix(tabId);
        return `${prefix}_${elementType}`;
    }

    // ============ STATE MANAGEMENT ============
    let dataState = {
        'rumah-tangga': {
            allData: [],
            filteredData: [],
            currentPage: 1,
            entries: 10,
            searchTerm: '',
            filterBy: 'nama',
            totalPages: 1
        },
        'umkm': {
            allData: [],
            filteredData: [],
            currentPage: 1,
            entries: 10,
            searchTerm: '',
            filterBy: 'nama',
            totalPages: 1
        },
        'badan-usaha': {
            allData: [],
            filteredData: [],
            currentPage: 1,
            entries: 10,
            searchTerm: '',
            filterBy: 'nama',
            totalPages: 1
        }
    };

    let currentEditData = null;
    let currentEditRowIndex = null;
    let currentEditTab = '';

    // ============ FUNGSI UTILITY ============
    function showNotification(message, isError = false) {
        notificationMessage.textContent = message;
        notification.style.borderLeftColor = isError ? '#dc3545' : '#2e7d32';
        notification.querySelector('i').style.color = isError ? '#dc3545' : '#2e7d32';
        notification.classList.add('show');
        setTimeout(() => {
            notification.classList.remove('show');
        }, 3000);
    }

    // Fungsi untuk memformat tanggal dari berbagai format ke YYYY-MM-DD
    function formatDateToInput(dateValue) {
        if (!dateValue) return '';
        
        // Jika sudah dalam format YYYY-MM-DD
        if (typeof dateValue === 'string' && /^\d{4}-\d{2}-\d{2}$/.test(dateValue)) {
            return dateValue;
        }
        
        // Jika dalam format object Date
        if (dateValue instanceof Date) {
            const year = dateValue.getFullYear();
            const month = String(dateValue.getMonth() + 1).padStart(2, '0');
            const day = String(dateValue.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        // Jika dalam format string seperti "Wed Feb 18 2026..."
        if (typeof dateValue === 'string') {
            const date = new Date(dateValue);
            if (!isNaN(date.getTime())) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }
        }
        
        return '';
    }

    // ============ FUNGSI UPDATE STATS ============
    function updateStats(tabId) {
        const state = dataState[tabId];
        const data = state.allData;
        
        if (tabId === 'rumah-tangga') {
            let lps = 0, subsidi = 0, tidak = 0;
            
            data.forEach(item => {
                const status = (item.STATUS || item.STATUS1 || '').toUpperCase();
                if (status.includes('PESERTA LPS') && !status.includes('SUBSIDI')) {
                    lps++;
                } else if (status.includes('SUBSIDI')) {
                    subsidi++;
                } else if (status.includes('TIDAK')) {
                    tidak++;
                }
            });
            
            document.getElementById('rt_stat_lps').textContent = lps;
            document.getElementById('rt_stat_subsidi').textContent = subsidi;
            document.getElementById('rt_stat_tidak').textContent = tidak;
            document.getElementById('rt_stat_total').textContent = data.length;
            
        } else if (tabId === 'umkm') {
            let lps = 0, dlhk = 0, tidak = 0;
            
            data.forEach(item => {
                const status = (item.STATUS || item.STATUS2 || '').toUpperCase();
                if (status === 'PESERTA LPS') {
                    lps++;
                } else if (status === 'PESERTA DLHK') {
                    dlhk++;
                } else if (status === 'TIDAK IKUT LPS') {
                    tidak++;
                }
            });
            
            document.getElementById('umkm_stat_lps').textContent = lps;
            document.getElementById('umkm_stat_dlhk').textContent = dlhk;
            document.getElementById('umkm_stat_tidak').textContent = tidak;
            document.getElementById('umkm_stat_total').textContent = data.length;
            
        } else if (tabId === 'badan-usaha') {
            let lps = 0, dlhk = 0, tidak = 0;
            
            data.forEach(item => {
                const status = (item.STATUS || item.STATUS3 || '').toUpperCase();
                if (status === 'PESERTA LPS') {
                    lps++;
                } else if (status === 'PESERTA DLHK') {
                    dlhk++;
                } else if (status === 'TIDAK IKUT LPS') {
                    tidak++;
                }
            });
            
            document.getElementById('bu_stat_lps').textContent = lps;
            document.getElementById('bu_stat_dlhk').textContent = dlhk;
            document.getElementById('bu_stat_tidak').textContent = tidak;
            document.getElementById('bu_stat_total').textContent = data.length;
        }
    }

    // ============ FUNGSI SWITCH TAB ============
    window.switchTab = function(tabId) {
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });

        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });

        document.getElementById(tabId).classList.add('active');

        const tabButtons = document.querySelectorAll('.tab-btn');
        if (tabId === 'rumah-tangga') tabButtons[0].classList.add('active');
        else if (tabId === 'umkm') tabButtons[1].classList.add('active');
        else if (tabId === 'badan-usaha') tabButtons[2].classList.add('active');

        loadData(tabId);
    };

    // ============ FUNGSI RESET FORM ============
    function resetActiveForm() {
        const activeTab = document.querySelector('.tab-content.active').id;

        if (activeTab === 'rumah-tangga') {
            document.getElementById('rt_tanggal').valueAsDate = new Date();
            document.getElementById('rt_nama').value = '';
            document.getElementById('rt_nik').value = '';
            document.getElementById('rt_kk').value = '';
            document.getElementById('rt_alamat').value = '';
            document.getElementById('rt_rt').value = '';
            document.getElementById('rt_rw').value = '';
            document.getElementById('rt_kelurahan').value = 'PADANG TERUBUK';
            document.getElementById('rt_kecamatan').value = 'SENAPELAN';
            document.getElementById('rt_kota').value = 'PEKANBARU';
            document.getElementById('rt_provinsi').value = 'RIAU';
            document.getElementById('rt_telp').value = '';
            document.getElementById('rt_status').value = '';
            document.getElementById('rt_tarif').value = '';
        }
        else if (activeTab === 'umkm') {
            document.getElementById('umkm_tanggal').valueAsDate = new Date();
            document.getElementById('umkm_nama').value = '';
            document.getElementById('umkm_nama_usaha').value = '';
            document.getElementById('umkm_no_izin').value = '';
            document.getElementById('umkm_nik').value = '';
            document.getElementById('umkm_kk').value = '';
            document.getElementById('umkm_alamat').value = '';
            document.getElementById('umkm_rt').value = '';
            document.getElementById('umkm_rw').value = '';
            document.getElementById('umkm_kelurahan').value = 'PADANG TERUBUK';
            document.getElementById('umkm_kecamatan').value = 'SENAPELAN';
            document.getElementById('umkm_kota').value = 'PEKANBARU';
            document.getElementById('umkm_provinsi').value = 'RIAU';
            document.getElementById('umkm_telp').value = '';
            document.getElementById('umkm_status').value = '';
            document.getElementById('umkm_tarif').value = '';
        }
        else if (activeTab === 'badan-usaha') {
            document.getElementById('bu_tanggal').valueAsDate = new Date();
            document.getElementById('bu_nama').value = '';
            document.getElementById('bu_nama_usaha').value = '';
            document.getElementById('bu_no_izin').value = '';
            document.getElementById('bu_nik').value = '';
            document.getElementById('bu_kk').value = '';
            document.getElementById('bu_alamat').value = '';
            document.getElementById('bu_rt').value = '';
            document.getElementById('bu_rw').value = '';
            document.getElementById('bu_kelurahan').value = 'PADANG TERUBUK';
            document.getElementById('bu_kecamatan').value = 'SENAPELAN';
            document.getElementById('bu_kota').value = 'PEKANBARU';
            document.getElementById('bu_provinsi').value = 'RIAU';
            document.getElementById('bu_telp').value = '';
            document.getElementById('bu_status').value = '';
            document.getElementById('bu_tarif').value = '';
        }

        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    }

    // ============ FUNGSI LOAD DATA ============
    window.loadData = async function(tabId) {
        const sheetName = tabId === 'rumah-tangga' ? 'RUMAHTANGGA' :
                         tabId === 'umkm' ? 'UMKM' : 'BADANUSAHA';

        const state = dataState[tabId];
        const prefix = getPrefix(tabId);
        
        // Ambil nilai entries dengan ID yang benar
        const entriesElement = document.getElementById(prefix + '_entries');
        if (entriesElement) {
            state.entries = parseInt(entriesElement.value);
        }

        try {
            const tableBody = document.getElementById(prefix + '_table_body');
            tableBody.innerHTML = `<tr><td colspan="20" style="text-align: center; padding: 2rem;"><i class="fas fa-spinner fa-spin"></i> Memuat data...</td></tr>`;

            const response = await fetch(`${APPS_SCRIPT_URL}?action=getData&sheet=${sheetName}`);
            const result = await response.json();

            if (result.success) {
                // Format data: pastikan tanggal dalam format YYYY-MM-DD
                state.allData = (result.data || []).map(item => {
                    const formattedItem = { ...item };
                    
                    // Format TANGGAL_INPUT ke YYYY-MM-DD
                    if (item.TANGGAL_INPUT) {
                        formattedItem.TANGGAL_INPUT = formatDateToInput(item.TANGGAL_INPUT);
                    }
                    if (item.TANGGAL_INPUT1) {
                        formattedItem.TANGGAL_INPUT1 = formatDateToInput(item.TANGGAL_INPUT1);
                    }
                    
                    return formattedItem;
                });
                
                state.filteredData = [...state.allData];
                updateStats(tabId);
                applyFilter(tabId);
            } else {
                showNotification('Gagal memuat data: ' + result.message, true);
                state.allData = [];
                state.filteredData = [];
                updateStats(tabId);
                renderTable(tabId);
            }
        } catch (error) {
            console.error('Error loading data:', error);
            showNotification('Gagal memuat data dari server', true);
            state.allData = [];
            state.filteredData = [];
            updateStats(tabId);
            renderTable(tabId);
        }
    };

    // ============ FUNGSI APPLY FILTER ============
    function applyFilter(tabId) {
        const state = dataState[tabId];
        const searchTerm = state.searchTerm.toLowerCase();

        if (!searchTerm) {
            state.filteredData = [...state.allData];
        } else {
            state.filteredData = state.allData.filter(item => {
                // Ambil nilai kolom yang akan dicari
                const nama = (item.NAMA_PESERTA || item.NAMA_PESERTA1 || item.NAMA_PESERTA2 || item.NAMA_PESERTA3 || '').toLowerCase();
                const alamat = (item.ALAMAT || item.ALAMAT1 || item.ALAMAT2 || item.ALAMAT3 || '').toLowerCase();
                const rt = (item.RT || item.RT1 || item.RT2 || item.RT3 || '').toLowerCase();
                const rw = (item.RW || item.RW1 || item.RW2 || item.RW3 || '').toLowerCase();
                const nik = (item.NO_NIK || item.NO_NIK1 || item.NO_NIK2 || item.NO_NIK3 || '').toLowerCase();
                const kk = (item.NO_KK || item.NO_KK1 || item.NO_KK2 || item.NO_KK3 || '').toLowerCase();

                switch (state.filterBy) {
                    case 'nama':
                        return nama.includes(searchTerm);
                    case 'alamat':
                        return alamat.includes(searchTerm);
                    case 'rt':
                        return rt.includes(searchTerm);
                    case 'rw':
                        return rw.includes(searchTerm);
                    case 'nik':
                        return nik.includes(searchTerm);
                    case 'kk':
                        return kk.includes(searchTerm);
                    default:
                        return nama.includes(searchTerm) || 
                               alamat.includes(searchTerm) || 
                               rt.includes(searchTerm) || 
                               rw.includes(searchTerm) ||
                               nik.includes(searchTerm) ||
                               kk.includes(searchTerm);
                }
            });
        }

        state.totalPages = Math.ceil(state.filteredData.length / state.entries) || 1;
        if (state.currentPage > state.totalPages) {
            state.currentPage = 1;
        }

        renderTable(tabId);
    }

    // ============ FUNGSI RENDER TABLE ============
    function renderTable(tabId) {
        const state = dataState[tabId];
        const prefix = getPrefix(tabId);
        const tableBody = document.getElementById(prefix + '_table_body');
        
        const start = (state.currentPage - 1) * state.entries;
        const end = Math.min(start + state.entries, state.filteredData.length);
        const pageData = state.filteredData.slice(start, end);

        if (state.filteredData.length === 0) {
            tableBody.innerHTML = `<tr><td colspan="20" style="text-align: center; padding: 2rem;">Tidak ada data</td></tr>`;
        } else {
            let html = '';
            pageData.forEach((item, index) => {
                const rowNumber = start + index + 1;
                const originalIndex = item.rowIndex;

                html += '<tr>';
                html += `<td>${rowNumber}</td>`;
                html += `<td><button class="btn-edit" onclick="openEditModal('${tabId}', ${originalIndex})"><i class="fas fa-pen"></i></button></td>`;

                if (tabId === 'rumah-tangga') {
                    html += `<td>${item.TANGGAL_INPUT || ''}</td>`;
                    html += `<td>${item.NAMA_PESERTA || ''}</td>`;
                    html += `<td>${item.NO_NIK || ''}</td>`;
                    html += `<td>${item.NO_KK || ''}</td>`;
                    html += `<td>${item.ALAMAT || ''}</td>`;
                    html += `<td>${item.RT || ''}</td>`;
                    html += `<td>${item.RW || ''}</td>`;
                    html += `<td>${item.KELURAHAN || ''}</td>`;
                    html += `<td>${item.KECAMATAN || ''}</td>`;
                    html += `<td>${item.KOTA || ''}</td>`;
                    html += `<td>${item.PROVINSI || ''}</td>`;
                    html += `<td>${item.NO_TELP || ''}</td>`;
                    html += `<td>${item.STATUS || ''}</td>`;
                    html += `<td>${item.TARIF_IURAN || ''}</td>`;
                } else if (tabId === 'umkm') {
                    html += `<td>${item.TANGGAL_INPUT || ''}</td>`;
                    html += `<td>${item.NAMA_PESERTA || ''}</td>`;
                    html += `<td>${item.NAMA_UMKM || ''}</td>`;
                    html += `<td>${item.NO_SURAT_IZIN_USAHA_UMKM || ''}</td>`;
                    html += `<td>${item.NO_NIK || ''}</td>`;
                    html += `<td>${item.NO_KK || ''}</td>`;
                    html += `<td>${item.ALAMAT || ''}</td>`;
                    html += `<td>${item.RT || ''}</td>`;
                    html += `<td>${item.RW || ''}</td>`;
                    html += `<td>${item.KELURAHAN || ''}</td>`;
                    html += `<td>${item.KECAMATAN || ''}</td>`;
                    html += `<td>${item.KOTA || ''}</td>`;
                    html += `<td>${item.PROVINSI || ''}</td>`;
                    html += `<td>${item.NO_TELP || ''}</td>`;
                    html += `<td>${item.STATUS || ''}</td>`;
                    html += `<td>${item.TARIF_IURAN || ''}</td>`;
                } else { // badan-usaha
                    html += `<td>${item.TANGGAL_INPUT || ''}</td>`;
                    html += `<td>${item.NAMA_PESERTA || ''}</td>`;
                    html += `<td>${item.NAMA_BADAN_USAHA || ''}</td>`;
                    html += `<td>${item.NO_SURAT_IZIN_BADAN_USAHA || ''}</td>`;
                    html += `<td>${item.NO_NIK || ''}</td>`;
                    html += `<td>${item.NO_KK || ''}</td>`;
                    html += `<td>${item.ALAMAT || ''}</td>`;
                    html += `<td>${item.RT || ''}</td>`;
                    html += `<td>${item.RW || ''}</td>`;
                    html += `<td>${item.KELURAHAN || ''}</td>`;
                    html += `<td>${item.KECAMATAN || ''}</td>`;
                    html += `<td>${item.KOTA || ''}</td>`;
                    html += `<td>${item.PROVINSI || ''}</td>`;
                    html += `<td>${item.NO_TELP || ''}</td>`;
                    html += `<td>${item.STATUS || ''}</td>`;
                    html += `<td>${item.TARIF_IURAN || ''}</td>`;
                }
                html += '</tr>';
            });
            tableBody.innerHTML = html;
        }

        // Update pagination dengan ID yang benar
        const pageInfo = document.getElementById(prefix + '_page_info');
        const prevBtn = document.getElementById(prefix + '_prev');
        const nextBtn = document.getElementById(prefix + '_next');
        
        if (pageInfo) {
            pageInfo.textContent = `Halaman ${state.currentPage} dari ${state.totalPages}`;
        }
        if (prevBtn) {
            prevBtn.disabled = state.currentPage <= 1;
        }
        if (nextBtn) {
            nextBtn.disabled = state.currentPage >= state.totalPages;
        }
    }

    // ============ FUNGSI FILTER ============
    window.filterData = function(tabId) {
        const prefix = getPrefix(tabId);
        const searchInput = document.getElementById(prefix + '_search');
        if (searchInput) {
            dataState[tabId].searchTerm = searchInput.value;
        }
        dataState[tabId].currentPage = 1;
        applyFilter(tabId);
    };

    // ============ FUNGSI SET FILTER ============
    window.setFilter = function(tabId, filterBy, event) {
        // Hapus class active dari semua chip di tab ini
        const chips = document.querySelectorAll(`#${tabId} .filter-chip`);
        chips.forEach(chip => chip.classList.remove('active'));
        
        // Tambah class active ke chip yang diklik
        event.currentTarget.classList.add('active');

        dataState[tabId].filterBy = filterBy;
        dataState[tabId].currentPage = 1;
        applyFilter(tabId);
    };

    // ============ FUNGSI CHANGE PAGE ============
    window.changePage = function(tabId, direction) {
        const state = dataState[tabId];
        if (direction === 'prev' && state.currentPage > 1) {
            state.currentPage--;
        } else if (direction === 'next' && state.currentPage < state.totalPages) {
            state.currentPage++;
        }
        renderTable(tabId);
    };

    // ============ FUNGSI OPEN EDIT MODAL ============
    window.openEditModal = function(tabId, rowIndex) {
        currentEditTab = tabId;
        const itemToEdit = dataState[tabId].allData.find(item => item.rowIndex === rowIndex);

        if (!itemToEdit) {
            showNotification('Data tidak ditemukan', true);
            return;
        }

        currentEditData = { ...itemToEdit };
        currentEditRowIndex = rowIndex;

        const formContainer = document.getElementById('editFormContainer');
        let formHtml = '<div class="form-grid">';

        if (tabId === 'rumah-tangga') {
            formHtml += `
                <div class="input-group full-width">
                    <label><i class="fas fa-calendar-alt"></i> TANGGAL INPUT</label>
                    <div class="input-wrapper">
                        <i class="fas fa-calendar-check"></i>
                        <input type="date" id="edit_tanggal" class="tanggal-input" value="${formatDateToInput(currentEditData.TANGGAL_INPUT || currentEditData.TANGGAL_INPUT1) || ''}">
                    </div>
                </div>
                <div class="input-group full-width">
                    <label><i class="fas fa-user"></i> NAMA PESERTA</label>
                    <div class="input-wrapper">
                        <i class="fas fa-user-pen"></i>
                        <input type="text" id="edit_nama" class="uppercase-input" value="${(currentEditData.NAMA_PESERTA || currentEditData.NAMA_PESERTA1 || '').replace(/^'/, '')}">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-id-card"></i> NO. NIK</label>
                    <div class="input-wrapper">
                        <i class="fas fa-id-card"></i>
                        <input type="text" id="edit_nik" class="nik-input" value="${(currentEditData.NO_NIK || currentEditData.NO_NIK1 || '').replace(/^'/, '')}" maxlength="16">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-id-card-clip"></i> NO. KK</label>
                    <div class="input-wrapper">
                        <i class="fas fa-id-card-clip"></i>
                        <input type="text" id="edit_kk" class="kk-input" value="${(currentEditData.NO_KK || currentEditData.NO_KK1 || '').replace(/^'/, '')}" maxlength="16">
                    </div>
                </div>
                <div class="input-group full-width">
                    <label><i class="fas fa-map-pin"></i> ALAMAT</label>
                    <div class="input-wrapper">
                        <i class="fas fa-map-location-dot"></i>
                        <textarea id="edit_alamat" class="uppercase-input">${(currentEditData.ALAMAT || currentEditData.ALAMAT1 || '').replace(/^'/, '')}</textarea>
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-road"></i> RT</label>
                    <div class="input-wrapper">
                        <i class="fas fa-route"></i>
                        <input type="text" id="edit_rt" class="rt-input" value="${(currentEditData.RT || currentEditData.RT1 || '').replace(/^'/, '')}" maxlength="3">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-road"></i> RW</label>
                    <div class="input-wrapper">
                        <i class="fas fa-route"></i>
                        <input type="text" id="edit_rw" class="rw-input" value="${(currentEditData.RW || currentEditData.RW1 || '').replace(/^'/, '')}" maxlength="3">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-map"></i> KELURAHAN</label>
                    <div class="input-wrapper">
                        <i class="fas fa-map"></i>
                        <input type="text" id="edit_kelurahan" class="uppercase-input" value="${(currentEditData.KELURAHAN || currentEditData.KELURAHAN1 || 'PADANG TERUBUK').replace(/^'/, '')}">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-map"></i> KECAMATAN</label>
                    <div class="input-wrapper">
                        <i class="fas fa-map"></i>
                        <input type="text" id="edit_kecamatan" class="uppercase-input" value="${(currentEditData.KECAMATAN || currentEditData.KECAMATAN1 || 'SENAPELAN').replace(/^'/, '')}">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-city"></i> KOTA</label>
                    <div class="input-wrapper">
                        <i class="fas fa-city"></i>
                        <input type="text" id="edit_kota" class="uppercase-input" value="${(currentEditData.KOTA || currentEditData.KOTA1 || 'PEKANBARU').replace(/^'/, '')}">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-flag"></i> PROVINSI</label>
                    <div class="input-wrapper">
                        <i class="fas fa-flag"></i>
                        <input type="text" id="edit_provinsi" class="uppercase-input" value="${(currentEditData.PROVINSI || currentEditData.PROVINSI1 || 'RIAU').replace(/^'/, '')}">
                    </div>
                </div>
                <div class="input-group full-width">
                    <label><i class="fas fa-phone-alt"></i> NO. TELP / HP</label>
                    <div class="input-wrapper">
                        <i class="fas fa-phone-alt"></i>
                        <input type="tel" id="edit_telp" class="telp-input" value="${(currentEditData.NO_TELP || currentEditData.NO_TELP1 || '').replace(/^'/, '')}" maxlength="15">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-toggle-on"></i> STATUS</label>
                    <div class="input-wrapper">
                        <i class="fas fa-check-circle"></i>
                        <select id="edit_status">
                            <option value="" ${!currentEditData.STATUS ? 'selected' : ''} disabled>-- PILIH STATUS --</option>
                            <option value="PESERTA LPS" ${(currentEditData.STATUS || currentEditData.STATUS1) === 'PESERTA LPS' ? 'selected' : ''}>PESERTA LPS</option>
                            <option value="PESERTA SUBSIDI SILANG" ${(currentEditData.STATUS || currentEditData.STATUS1) === 'PESERTA SUBSIDI SILANG' ? 'selected' : ''}>PESERTA SUBSIDI SILANG</option>
                            <option value="TIDAK IKUT LPS" ${(currentEditData.STATUS || currentEditData.STATUS1) === 'TIDAK IKUT LPS' ? 'selected' : ''}>TIDAK IKUT LPS</option>
                        </select>
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-money-bill-wave"></i> TARIF IURAN (Rp)</label>
                    <div class="input-wrapper">
                        <i class="fas fa-hand-holding-usd"></i>
                        <input type="number" id="edit_tarif" value="${currentEditData.TARIF_IURAN || currentEditData.TARIF_IURAN1 || '0'}" min="0" step="1000">
                    </div>
                </div>
            `;
        } else if (tabId === 'umkm') {
            formHtml += `
                <div class="input-group full-width">
                    <label><i class="fas fa-calendar-alt"></i> TANGGAL INPUT</label>
                    <div class="input-wrapper">
                        <i class="fas fa-calendar-check"></i>
                        <input type="date" id="edit_tanggal" class="tanggal-input" value="${formatDateToInput(currentEditData.TANGGAL_INPUT || currentEditData.TANGGAL_INPUT2) || ''}">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-user"></i> NAMA PEMILIK</label>
                    <div class="input-wrapper">
                        <i class="fas fa-user-pen"></i>
                        <input type="text" id="edit_nama" class="uppercase-input" value="${(currentEditData.NAMA_PESERTA || currentEditData.NAMA_PESERTA2 || '').replace(/^'/, '')}">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-store-alt"></i> NAMA UMKM</label>
                    <div class="input-wrapper">
                        <i class="fas fa-store-alt"></i>
                        <input type="text" id="edit_nama_usaha" class="uppercase-input" value="${(currentEditData.NAMA_UMKM || '').replace(/^'/, '')}">
                    </div>
                </div>
                <div class="input-group full-width">
                    <label><i class="fas fa-file-contract"></i> NO. SURAT IZIN USAHA</label>
                    <div class="input-wrapper">
                        <i class="fas fa-file-contract"></i>
                        <input type="text" id="edit_no_izin" class="uppercase-input" value="${(currentEditData.NO_SURAT_IZIN_USAHA_UMKM || '').replace(/^'/, '')}">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-id-card"></i> NO. NIK</label>
                    <div class="input-wrapper">
                        <i class="fas fa-id-card"></i>
                        <input type="text" id="edit_nik" class="nik-input" value="${(currentEditData.NO_NIK || currentEditData.NO_NIK2 || '').replace(/^'/, '')}" maxlength="16">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-id-card-clip"></i> NO. KK</label>
                    <div class="input-wrapper">
                        <i class="fas fa-id-card-clip"></i>
                        <input type="text" id="edit_kk" class="kk-input" value="${(currentEditData.NO_KK || currentEditData.NO_KK2 || '').replace(/^'/, '')}" maxlength="16">
                    </div>
                </div>
                <div class="input-group full-width">
                    <label><i class="fas fa-map-pin"></i> ALAMAT USAHA</label>
                    <div class="input-wrapper">
                        <i class="fas fa-map-location-dot"></i>
                        <textarea id="edit_alamat" class="uppercase-input">${(currentEditData.ALAMAT || currentEditData.ALAMAT2 || '').replace(/^'/, '')}</textarea>
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-road"></i> RT</label>
                    <div class="input-wrapper">
                        <i class="fas fa-route"></i>
                        <input type="text" id="edit_rt" class="rt-input" value="${(currentEditData.RT || currentEditData.RT2 || '').replace(/^'/, '')}" maxlength="3">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-road"></i> RW</label>
                    <div class="input-wrapper">
                        <i class="fas fa-route"></i>
                        <input type="text" id="edit_rw" class="rw-input" value="${(currentEditData.RW || currentEditData.RW2 || '').replace(/^'/, '')}" maxlength="3">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-map"></i> KELURAHAN</label>
                    <div class="input-wrapper">
                        <i class="fas fa-map"></i>
                        <input type="text" id="edit_kelurahan" class="uppercase-input" value="${(currentEditData.KELURAHAN || currentEditData.KELURAHAN2 || 'PADANG TERUBUK').replace(/^'/, '')}">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-map"></i> KECAMATAN</label>
                    <div class="input-wrapper">
                        <i class="fas fa-map"></i>
                        <input type="text" id="edit_kecamatan" class="uppercase-input" value="${(currentEditData.KECAMATAN || currentEditData.KECAMATAN2 || 'SENAPELAN').replace(/^'/, '')}">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-city"></i> KOTA</label>
                    <div class="input-wrapper">
                        <i class="fas fa-city"></i>
                        <input type="text" id="edit_kota" class="uppercase-input" value="${(currentEditData.KOTA || currentEditData.KOTA2 || 'PEKANBARU').replace(/^'/, '')}">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-flag"></i> PROVINSI</label>
                    <div class="input-wrapper">
                        <i class="fas fa-flag"></i>
                        <input type="text" id="edit_provinsi" class="uppercase-input" value="${(currentEditData.PROVINSI || currentEditData.PROVINSI2 || 'RIAU').replace(/^'/, '')}">
                    </div>
                </div>
                <div class="input-group full-width">
                    <label><i class="fas fa-phone-alt"></i> NO. TELP / HP</label>
                    <div class="input-wrapper">
                        <i class="fas fa-phone-alt"></i>
                        <input type="tel" id="edit_telp" class="telp-input" value="${(currentEditData.NO_TELP || currentEditData.NO_TELP2 || '').replace(/^'/, '')}" maxlength="15">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-toggle-on"></i> STATUS</label>
                    <div class="input-wrapper">
                        <i class="fas fa-check-circle"></i>
                        <select id="edit_status">
                            <option value="" ${!currentEditData.STATUS ? 'selected' : ''} disabled>-- PILIH STATUS --</option>
                            <option value="PESERTA LPS" ${(currentEditData.STATUS || currentEditData.STATUS2) === 'PESERTA LPS' ? 'selected' : ''}>PESERTA LPS</option>
                            <option value="PESERTA DLHK" ${(currentEditData.STATUS || currentEditData.STATUS2) === 'PESERTA DLHK' ? 'selected' : ''}>PESERTA DLHK</option>
                            <option value="TIDAK IKUT LPS" ${(currentEditData.STATUS || currentEditData.STATUS2) === 'TIDAK IKUT LPS' ? 'selected' : ''}>TIDAK IKUT LPS</option>
                        </select>
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-money-bill-wave"></i> TARIF IURAN (Rp)</label>
                    <div class="input-wrapper">
                        <i class="fas fa-hand-holding-usd"></i>
                        <input type="number" id="edit_tarif" value="${currentEditData.TARIF_IURAN || currentEditData.TARIF_IURAN2 || '0'}" min="0" step="1000">
                    </div>
                </div>
            `;
        } else { // badan-usaha
            formHtml += `
                <div class="input-group full-width">
                    <label><i class="fas fa-calendar-alt"></i> TANGGAL INPUT</label>
                    <div class="input-wrapper">
                        <i class="fas fa-calendar-check"></i>
                        <input type="date" id="edit_tanggal" class="tanggal-input" value="${formatDateToInput(currentEditData.TANGGAL_INPUT || currentEditData.TANGGAL_INPUT3) || ''}">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-user"></i> NAMA PENANGGUNG JAWAB</label>
                    <div class="input-wrapper">
                        <i class="fas fa-user-pen"></i>
                        <input type="text" id="edit_nama" class="uppercase-input" value="${(currentEditData.NAMA_PESERTA || currentEditData.NAMA_PESERTA3 || '').replace(/^'/, '')}">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-building"></i> NAMA BADAN USAHA</label>
                    <div class="input-wrapper">
                        <i class="fas fa-building"></i>
                        <input type="text" id="edit_nama_usaha" class="uppercase-input" value="${(currentEditData.NAMA_BADAN_USAHA || '').replace(/^'/, '')}">
                    </div>
                </div>
                <div class="input-group full-width">
                    <label><i class="fas fa-file-contract"></i> NO. SURAT IZIN USAHA</label>
                    <div class="input-wrapper">
                        <i class="fas fa-file-contract"></i>
                        <input type="text" id="edit_no_izin" class="uppercase-input" value="${(currentEditData.NO_SURAT_IZIN_BADAN_USAHA || '').replace(/^'/, '')}">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-id-card"></i> NO. NIK</label>
                    <div class="input-wrapper">
                        <i class="fas fa-id-card"></i>
                        <input type="text" id="edit_nik" class="nik-input" value="${(currentEditData.NO_NIK || currentEditData.NO_NIK3 || '').replace(/^'/, '')}" maxlength="16">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-id-card-clip"></i> NO. KK</label>
                    <div class="input-wrapper">
                        <i class="fas fa-id-card-clip"></i>
                        <input type="text" id="edit_kk" class="kk-input" value="${(currentEditData.NO_KK || currentEditData.NO_KK3 || '').replace(/^'/, '')}" maxlength="16">
                    </div>
                </div>
                <div class="input-group full-width">
                    <label><i class="fas fa-map-pin"></i> ALAMAT USAHA</label>
                    <div class="input-wrapper">
                        <i class="fas fa-map-location-dot"></i>
                        <textarea id="edit_alamat" class="uppercase-input">${(currentEditData.ALAMAT || currentEditData.ALAMAT3 || '').replace(/^'/, '')}</textarea>
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-road"></i> RT</label>
                    <div class="input-wrapper">
                        <i class="fas fa-route"></i>
                        <input type="text" id="edit_rt" class="rt-input" value="${(currentEditData.RT || currentEditData.RT3 || '').replace(/^'/, '')}" maxlength="3">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-road"></i> RW</label>
                    <div class="input-wrapper">
                        <i class="fas fa-route"></i>
                        <input type="text" id="edit_rw" class="rw-input" value="${(currentEditData.RW || currentEditData.RW3 || '').replace(/^'/, '')}" maxlength="3">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-map"></i> KELURAHAN</label>
                    <div class="input-wrapper">
                        <i class="fas fa-map"></i>
                        <input type="text" id="edit_kelurahan" class="uppercase-input" value="${(currentEditData.KELURAHAN || currentEditData.KELURAHAN3 || 'PADANG TERUBUK').replace(/^'/, '')}">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-map"></i> KECAMATAN</label>
                    <div class="input-wrapper">
                        <i class="fas fa-map"></i>
                        <input type="text" id="edit_kecamatan" class="uppercase-input" value="${(currentEditData.KECAMATAN || currentEditData.KECAMATAN3 || 'SENAPELAN').replace(/^'/, '')}">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-city"></i> KOTA</label>
                    <div class="input-wrapper">
                        <i class="fas fa-city"></i>
                        <input type="text" id="edit_kota" class="uppercase-input" value="${(currentEditData.KOTA || currentEditData.KOTA3 || 'PEKANBARU').replace(/^'/, '')}">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-flag"></i> PROVINSI</label>
                    <div class="input-wrapper">
                        <i class="fas fa-flag"></i>
                        <input type="text" id="edit_provinsi" class="uppercase-input" value="${(currentEditData.PROVINSI || currentEditData.PROVINSI3 || 'RIAU').replace(/^'/, '')}">
                    </div>
                </div>
                <div class="input-group full-width">
                    <label><i class="fas fa-phone-alt"></i> NO. TELP / HP</label>
                    <div class="input-wrapper">
                        <i class="fas fa-phone-alt"></i>
                        <input type="tel" id="edit_telp" class="telp-input" value="${(currentEditData.NO_TELP || currentEditData.NO_TELP3 || '').replace(/^'/, '')}" maxlength="15">
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-toggle-on"></i> STATUS</label>
                    <div class="input-wrapper">
                        <i class="fas fa-check-circle"></i>
                        <select id="edit_status">
                            <option value="" ${!currentEditData.STATUS ? 'selected' : ''} disabled>-- PILIH STATUS --</option>
                            <option value="PESERTA LPS" ${(currentEditData.STATUS || currentEditData.STATUS3) === 'PESERTA LPS' ? 'selected' : ''}>PESERTA LPS</option>
                            <option value="PESERTA DLHK" ${(currentEditData.STATUS || currentEditData.STATUS3) === 'PESERTA DLHK' ? 'selected' : ''}>PESERTA DLHK</option>
                            <option value="TIDAK IKUT LPS" ${(currentEditData.STATUS || currentEditData.STATUS3) === 'TIDAK IKUT LPS' ? 'selected' : ''}>TIDAK IKUT LPS</option>
                        </select>
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-money-bill-wave"></i> TARIF IURAN (Rp)</label>
                    <div class="input-wrapper">
                        <i class="fas fa-hand-holding-usd"></i>
                        <input type="number" id="edit_tarif" value="${currentEditData.TARIF_IURAN || currentEditData.TARIF_IURAN3 || '0'}" min="0" step="1000">
                    </div>
                </div>
            `;
        }

        formHtml += '</div>';
        formContainer.innerHTML = formHtml;

        // Set tanggal ke hari ini jika kosong
        const tanggalInput = document.getElementById('edit_tanggal');
        if (!tanggalInput.value) {
            tanggalInput.valueAsDate = new Date();
        }

        // Tambahkan event listener untuk uppercase
        document.querySelectorAll('#editFormContainer .uppercase-input').forEach(input => {
            input.addEventListener('input', function() {
                this.value = this.value.toUpperCase();
            });
        });

        // Tambahkan event listener untuk angka
        document.querySelectorAll('#editFormContainer .nik-input, #editFormContainer .kk-input, #editFormContainer .telp-input, #editFormContainer .rt-input, #editFormContainer .rw-input').forEach(input => {
            input.addEventListener('input', function() {
                this.value = this.value.replace(/[^0-9]/g, '');
                if (this.classList.contains('nik-input') || this.classList.contains('kk-input')) {
                    if (this.value.length > 16) this.value = this.value.slice(0, 16);
                } else if (this.classList.contains('rt-input') || this.classList.contains('rw-input')) {
                    if (this.value.length > 3) this.value = this.value.slice(0, 3);
                } else if (this.classList.contains('telp-input')) {
                    if (this.value.length > 15) this.value = this.value.slice(0, 15);
                }
            });
        });

        editModal.classList.add('active');
    };

    // ============ FUNGSI CLOSE EDIT MODAL ============
    window.closeEditModal = function() {
        editModal.classList.remove('active');
        currentEditData = null;
        currentEditRowIndex = null;
        currentEditTab = '';
    };

    // ============ FUNGSI SAVE EDIT ============
    window.saveEdit = async function() {
        if (!currentEditTab || currentEditRowIndex === null || !currentEditData) return;

        const tabId = currentEditTab;
        const sheetName = tabId === 'rumah-tangga' ? 'RUMAHTANGGA' :
                         tabId === 'umkm' ? 'UMKM' : 'BADANUSAHA';

        const updatedData = { ...currentEditData };

        // Ambil data dari form edit
        if (tabId === 'rumah-tangga') {
            updatedData.TANGGAL_INPUT1 = document.getElementById('edit_tanggal').value;
            updatedData.NAMA_PESERTA1 = document.getElementById('edit_nama').value.toUpperCase();
            updatedData.NO_NIK1 = document.getElementById('edit_nik').value;
            updatedData.NO_KK1 = document.getElementById('edit_kk').value;
            updatedData.ALAMAT1 = document.getElementById('edit_alamat').value.toUpperCase();
            updatedData.RT1 = document.getElementById('edit_rt').value;
            updatedData.RW1 = document.getElementById('edit_rw').value;
            updatedData.KELURAHAN1 = document.getElementById('edit_kelurahan').value.toUpperCase();
            updatedData.KECAMATAN1 = document.getElementById('edit_kecamatan').value.toUpperCase();
            updatedData.KOTA1 = document.getElementById('edit_kota').value.toUpperCase();
            updatedData.PROVINSI1 = document.getElementById('edit_provinsi').value.toUpperCase();
            updatedData.NO_TELP1 = document.getElementById('edit_telp').value;
            updatedData.STATUS1 = document.getElementById('edit_status').value;
            updatedData.TARIF_IURAN1 = document.getElementById('edit_tarif').value;
            
            // Update juga versi tanpa angka
            updatedData.TANGGAL_INPUT = updatedData.TANGGAL_INPUT1;
            updatedData.NAMA_PESERTA = updatedData.NAMA_PESERTA1;
            updatedData.NO_NIK = updatedData.NO_NIK1;
            updatedData.NO_KK = updatedData.NO_KK1;
            updatedData.ALAMAT = updatedData.ALAMAT1;
            updatedData.RT = updatedData.RT1;
            updatedData.RW = updatedData.RW1;
            updatedData.KELURAHAN = updatedData.KELURAHAN1;
            updatedData.KECAMATAN = updatedData.KECAMATAN1;
            updatedData.KOTA = updatedData.KOTA1;
            updatedData.PROVINSI = updatedData.PROVINSI1;
            updatedData.NO_TELP = updatedData.NO_TELP1;
            updatedData.STATUS = updatedData.STATUS1;
            updatedData.TARIF_IURAN = updatedData.TARIF_IURAN1;
        } else if (tabId === 'umkm') {
            updatedData.TANGGAL_INPUT2 = document.getElementById('edit_tanggal').value;
            updatedData.NAMA_PESERTA2 = document.getElementById('edit_nama').value.toUpperCase();
            updatedData.NAMA_UMKM2 = document.getElementById('edit_nama_usaha').value.toUpperCase();
            updatedData.NO_SURAT_IZIN_USAHA_UMKM2 = document.getElementById('edit_no_izin').value.toUpperCase();
            updatedData.NO_NIK2 = document.getElementById('edit_nik').value;
            updatedData.NO_KK2 = document.getElementById('edit_kk').value;
            updatedData.ALAMAT2 = document.getElementById('edit_alamat').value.toUpperCase();
            updatedData.RT2 = document.getElementById('edit_rt').value;
            updatedData.RW2 = document.getElementById('edit_rw').value;
            updatedData.KELURAHAN2 = document.getElementById('edit_kelurahan').value.toUpperCase();
            updatedData.KECAMATAN2 = document.getElementById('edit_kecamatan').value.toUpperCase();
            updatedData.KOTA2 = document.getElementById('edit_kota').value.toUpperCase();
            updatedData.PROVINSI2 = document.getElementById('edit_provinsi').value.toUpperCase();
            updatedData.NO_TELP2 = document.getElementById('edit_telp').value;
            updatedData.STATUS2 = document.getElementById('edit_status').value;
            updatedData.TARIF_IURAN2 = document.getElementById('edit_tarif').value;
            
            // Update versi tanpa angka
            updatedData.TANGGAL_INPUT = updatedData.TANGGAL_INPUT2;
            updatedData.NAMA_PESERTA = updatedData.NAMA_PESERTA2;
            updatedData.NAMA_UMKM = updatedData.NAMA_UMKM2;
            updatedData.NO_SURAT_IZIN_USAHA_UMKM = updatedData.NO_SURAT_IZIN_USAHA_UMKM2;
            updatedData.NO_NIK = updatedData.NO_NIK2;
            updatedData.NO_KK = updatedData.NO_KK2;
            updatedData.ALAMAT = updatedData.ALAMAT2;
            updatedData.RT = updatedData.RT2;
            updatedData.RW = updatedData.RW2;
            updatedData.KELURAHAN = updatedData.KELURAHAN2;
            updatedData.KECAMATAN = updatedData.KECAMATAN2;
            updatedData.KOTA = updatedData.KOTA2;
            updatedData.PROVINSI = updatedData.PROVINSI2;
            updatedData.NO_TELP = updatedData.NO_TELP2;
            updatedData.STATUS = updatedData.STATUS2;
            updatedData.TARIF_IURAN = updatedData.TARIF_IURAN2;
        } else {
            updatedData.TANGGAL_INPUT3 = document.getElementById('edit_tanggal').value;
            updatedData.NAMA_PESERTA3 = document.getElementById('edit_nama').value.toUpperCase();
            updatedData.NAMA_BADAN_USAHA3 = document.getElementById('edit_nama_usaha').value.toUpperCase();
            updatedData.NO_SURAT_IZIN_BADAN_USAHA3 = document.getElementById('edit_no_izin').value.toUpperCase();
            updatedData.NO_NIK3 = document.getElementById('edit_nik').value;
            updatedData.NO_KK3 = document.getElementById('edit_kk').value;
            updatedData.ALAMAT3 = document.getElementById('edit_alamat').value.toUpperCase();
            updatedData.RT3 = document.getElementById('edit_rt').value;
            updatedData.RW3 = document.getElementById('edit_rw').value;
            updatedData.KELURAHAN3 = document.getElementById('edit_kelurahan').value.toUpperCase();
            updatedData.KECAMATAN3 = document.getElementById('edit_kecamatan').value.toUpperCase();
            updatedData.KOTA3 = document.getElementById('edit_kota').value.toUpperCase();
            updatedData.PROVINSI3 = document.getElementById('edit_provinsi').value.toUpperCase();
            updatedData.NO_TELP3 = document.getElementById('edit_telp').value;
            updatedData.STATUS3 = document.getElementById('edit_status').value;
            updatedData.TARIF_IURAN3 = document.getElementById('edit_tarif').value;
            
            // Update versi tanpa angka
            updatedData.TANGGAL_INPUT = updatedData.TANGGAL_INPUT3;
            updatedData.NAMA_PESERTA = updatedData.NAMA_PESERTA3;
            updatedData.NAMA_BADAN_USAHA = updatedData.NAMA_BADAN_USAHA3;
            updatedData.NO_SURAT_IZIN_BADAN_USAHA = updatedData.NO_SURAT_IZIN_BADAN_USAHA3;
            updatedData.NO_NIK = updatedData.NO_NIK3;
            updatedData.NO_KK = updatedData.NO_KK3;
            updatedData.ALAMAT = updatedData.ALAMAT3;
            updatedData.RT = updatedData.RT3;
            updatedData.RW = updatedData.RW3;
            updatedData.KELURAHAN = updatedData.KELURAHAN3;
            updatedData.KECAMATAN = updatedData.KECAMATAN3;
            updatedData.KOTA = updatedData.KOTA3;
            updatedData.PROVINSI = updatedData.PROVINSI3;
            updatedData.NO_TELP = updatedData.NO_TELP3;
            updatedData.STATUS = updatedData.STATUS3;
            updatedData.TARIF_IURAN = updatedData.TARIF_IURAN3;
        }

        loading.classList.add('active');

        try {
            const payload = {
                action: 'updateData',
                sheetName: sheetName,
                rowIndex: currentEditRowIndex,
                ...updatedData
            };

            const response = await fetch(APPS_SCRIPT_URL, {
                method: 'POST',
                mode: 'cors',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams(payload).toString()
            });
    
            const result = await response.json();

            loading.classList.remove('active');

            if (result.success) {
                const allDataIndex = dataState[tabId].allData.findIndex(item => item.rowIndex === currentEditRowIndex);
                if (allDataIndex !== -1) {
                    dataState[tabId].allData[allDataIndex] = { ...updatedData, rowIndex: currentEditRowIndex };
                }

                const filteredDataIndex = dataState[tabId].filteredData.findIndex(item => item.rowIndex === currentEditRowIndex);
                if (filteredDataIndex !== -1) {
                    dataState[tabId].filteredData[filteredDataIndex] = { ...updatedData, rowIndex: currentEditRowIndex };
                }

                updateStats(tabId);
                renderTable(tabId);
                closeEditModal();
                showNotification('Data berhasil diperbarui');
            } else {
                showNotification('Gagal memperbarui data: ' + result.message, true);
            }
        } catch (error) {
            loading.classList.remove('active');
            console.error('Error saving edit:', error);
            showNotification('Gagal menyimpan perubahan: ' + error.message, true);
        }
    };

    // ============ HANDLE SUBMIT RUMAH TANGGA ============
    document.getElementById('submitRumahTanggaBtn').addEventListener('click', async () => {
        const activeTab = 'rumah-tangga';
        let isValid = true;
        let errorMessage = '';

        if (!document.getElementById('rt_nama').value) {
            isValid = false;
            errorMessage = 'Nama peserta harus diisi!';
        }

        if (!isValid) {
            showNotification(errorMessage, true);
            return;
        }

        loading.classList.add('active');

        const formData = {
            sheetName: 'RUMAHTANGGA',
            TANGGAL_INPUT1: document.getElementById('rt_tanggal').value || '',
            NAMA_PESERTA1: document.getElementById('rt_nama').value.toUpperCase() || '',
            NO_NIK1: document.getElementById('rt_nik').value || '',
            NO_KK1: document.getElementById('rt_kk').value || '',
            ALAMAT1: document.getElementById('rt_alamat').value.toUpperCase() || '',
            RT1: document.getElementById('rt_rt').value || '',
            RW1: document.getElementById('rt_rw').value || '',
            KELURAHAN1: document.getElementById('rt_kelurahan').value.toUpperCase() || 'PADANG TERUBUK',
            KECAMATAN1: document.getElementById('rt_kecamatan').value.toUpperCase() || 'SENAPELAN',
            KOTA1: document.getElementById('rt_kota').value.toUpperCase() || 'PEKANBARU',
            PROVINSI1: document.getElementById('rt_provinsi').value.toUpperCase() || 'RIAU',
            NO_TELP1: document.getElementById('rt_telp').value || '',
            STATUS1: document.getElementById('rt_status').value || '',
            TARIF_IURAN1: document.getElementById('rt_tarif').value || '0'
        };

        try {
            const response = await fetch(APPS_SCRIPT_URL, {
                method: 'POST',
                mode: 'cors',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams(formData).toString()
            });

            const result = await response.json();
            
            loading.classList.remove('active');

            if (result.success) {
                modal.classList.add('active');
                loadData('rumah-tangga');
            } else {
                showNotification('Gagal menyimpan: ' + result.message, true);
            }

        } catch (error) {
            loading.classList.remove('active');
            console.error('Error detail:', error);
            showNotification('Gagal terhubung ke server', true);
        }
    });

    // ============ HANDLE SUBMIT UMKM ============
    document.getElementById('submitUmkmBtn').addEventListener('click', async () => {
        const activeTab = 'umkm';
        let isValid = true;
        let errorMessage = '';

        if (!document.getElementById('umkm_nama').value) {
            isValid = false;
            errorMessage = 'Nama pemilik harus diisi!';
        }

        if (!isValid) {
            showNotification(errorMessage, true);
            return;
        }

        loading.classList.add('active');

        const formData = {
            sheetName: 'UMKM',
            TANGGAL_INPUT2: document.getElementById('umkm_tanggal').value || '',
            NAMA_PESERTA2: document.getElementById('umkm_nama').value.toUpperCase() || '',
            NAMA_UMKM2: document.getElementById('umkm_nama_usaha').value.toUpperCase() || '',
            NO_SURAT_IZIN_USAHA_UMKM2: document.getElementById('umkm_no_izin').value.toUpperCase() || '',
            NO_NIK2: document.getElementById('umkm_nik').value || '',
            NO_KK2: document.getElementById('umkm_kk').value || '',
            ALAMAT2: document.getElementById('umkm_alamat').value.toUpperCase() || '',
            RT2: document.getElementById('umkm_rt').value || '',
            RW2: document.getElementById('umkm_rw').value || '',
            KELURAHAN2: document.getElementById('umkm_kelurahan').value.toUpperCase() || 'PADANG TERUBUK',
            KECAMATAN2: document.getElementById('umkm_kecamatan').value.toUpperCase() || 'SENAPELAN',
            KOTA2: document.getElementById('umkm_kota').value.toUpperCase() || 'PEKANBARU',
            PROVINSI2: document.getElementById('umkm_provinsi').value.toUpperCase() || 'RIAU',
            NO_TELP2: document.getElementById('umkm_telp').value || '',
            STATUS2: document.getElementById('umkm_status').value || '',
            TARIF_IURAN2: document.getElementById('umkm_tarif').value || '0'
        };

        try {
            const response = await fetch(APPS_SCRIPT_URL, {
                method: 'POST',
                mode: 'cors',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams(formData).toString()
            });

            const result = await response.json();
            
            loading.classList.remove('active');

            if (result.success) {
                modal.classList.add('active');
                loadData('umkm');
            } else {
                showNotification('Gagal menyimpan: ' + result.message, true);
            }

        } catch (error) {
            loading.classList.remove('active');
            console.error('Error detail:', error);
            showNotification('Gagal terhubung ke server', true);
        }
    });

    // ============ HANDLE SUBMIT BADAN USAHA ============
    document.getElementById('submitBadanUsahaBtn').addEventListener('click', async () => {
        const activeTab = 'badan-usaha';
        let isValid = true;
        let errorMessage = '';

        if (!document.getElementById('bu_nama').value) {
            isValid = false;
            errorMessage = 'Nama penanggung jawab harus diisi!';
        }

        if (!isValid) {
            showNotification(errorMessage, true);
            return;
        }

        loading.classList.add('active');

        const formData = {
            sheetName: 'BADANUSAHA',
            TANGGAL_INPUT3: document.getElementById('bu_tanggal').value || '',
            NAMA_PESERTA3: document.getElementById('bu_nama').value.toUpperCase() || '',
            NAMA_BADAN_USAHA3: document.getElementById('bu_nama_usaha').value.toUpperCase() || '',
            NO_SURAT_IZIN_BADAN_USAHA3: document.getElementById('bu_no_izin').value.toUpperCase() || '',
            NO_NIK3: document.getElementById('bu_nik').value || '',
            NO_KK3: document.getElementById('bu_kk').value || '',
            ALAMAT3: document.getElementById('bu_alamat').value.toUpperCase() || '',
            RT3: document.getElementById('bu_rt').value || '',
            RW3: document.getElementById('bu_rw').value || '',
            KELURAHAN3: document.getElementById('bu_kelurahan').value.toUpperCase() || 'PADANG TERUBUK',
            KECAMATAN3: document.getElementById('bu_kecamatan').value.toUpperCase() || 'SENAPELAN',
            KOTA3: document.getElementById('bu_kota').value.toUpperCase() || 'PEKANBARU',
            PROVINSI3: document.getElementById('bu_provinsi').value.toUpperCase() || 'RIAU',
            NO_TELP3: document.getElementById('bu_telp').value || '',
            STATUS3: document.getElementById('bu_status').value || '',
            TARIF_IURAN3: document.getElementById('bu_tarif').value || '0'
        };

        try {
            const response = await fetch(APPS_SCRIPT_URL, {
                method: 'POST',
                mode: 'cors',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams(formData).toString()
            });

            const result = await response.json();
            
            loading.classList.remove('active');

            if (result.success) {
                modal.classList.add('active');
                loadData('badan-usaha');
            } else {
                showNotification('Gagal menyimpan: ' + result.message, true);
            }

        } catch (error) {
            loading.classList.remove('active');
            console.error('Error detail:', error);
            showNotification('Gagal terhubung ke server', true);
        }
    });

    // ============ TOMBOL MODAL ============
    document.getElementById('lanjutBtn').addEventListener('click', () => {
        modal.classList.remove('active');
        resetActiveForm();
    });

    document.getElementById('keluarBtn').addEventListener('click', () => {
        window.location.href = 'https://lpspadangterubukasri.github.io/Home';
    });

    // ============ LOAD DATA PERTAMA KALI ============
    document.addEventListener('DOMContentLoaded', () => {
        loadData('rumah-tangga');
    });

    // Expose function ke global
    window.switchTab = switchTab;
    window.loadData = loadData;
    window.filterData = filterData;
    window.setFilter = setFilter;
    window.changePage = changePage;
    window.openEditModal = openEditModal;
    window.closeEditModal = closeEditModal;
    window.saveEdit = saveEdit;
    window.formatRT_RW = formatRT_RW;
</script>
</body>
</html>


